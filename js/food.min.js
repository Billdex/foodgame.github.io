function commaSeparatedMatch(e,a){if(0===a.length)return!0;for(var t=a.split(/[,\s]/),i=0;i<t.length;i++)if(0!==t[i].length&&-1!==e.indexOf(t[i]))return!0;return!1}function init(e){var a;initFunction();try{var t=localStorage.getItem("data");a=JSON.parse(t)}catch(e){}if(private)$.ajax({cache:!1,success:function(t){$.ajax({cache:!1,success:function(i){t=$.extend(t,i);var l=generateData(e,t,a);initTables(l,a)},error:function(){var i=generateData(e,t,a);initTables(i,a)},url:"others/data/data3.json"})},error:function(){var t=generateData(e,null,a);initTables(t,a)},url:"others/data/data2.json"});else{var i=generateData(e,null,a);initTables(i,a)}}function initFunction(){var e=getParameterByName("a");e&&"cb8f8a72f7e4924a75cb75a4a59c0b8d61e70c0cb84f84edf7ede4c8"==lcode(e)&&(private=!0,$("head").append('<link rel="stylesheet" type="text/css" href="others/css/image.css">'),$("#chk-recipe-no-origin").closest(".btn").removeClass("hidden"),$("#chk-chef-no-origin").closest(".btn").removeClass("hidden"),$("#chk-equip-no-origin").closest(".btn").removeClass("hidden"),$("#chk-decoration-no-origin").closest(".btn").removeClass("hidden"),$("#chk-cal-no-origin").closest(".btn").removeClass("hidden"),$("#chk-cal-no-origin").prop("checked",!0))}function initTables(e,a){updateMenu(a),setPartialUltimateOptions(e.chefs,e.partialSkill),initRecipeTable(e),initChefTable(e),initEquipTable(e),initDecorationTable(e),initMaterialTable(e),initQuestTable(e),initImportExport(e),initCalTables(e),$.fn.dataTable.ext.order["dom-selected"]=function(e,a){return this.api().column(a,{order:"index"}).nodes().map(function(e,a){return $(e).parent("tr").hasClass("selected")?"1":"0"})},initInfo(e),initVersionTip(a),initTooltip(),initSetting(e),updateSetting(a),$('.main-nav a[data-id="1"], .main-nav a[data-id="2"]').on("show.bs.tab",function(e){"1"==$(e.target).attr("data-id")?$("#select-partial-ultimate").appendTo("#select-partial-ultimate-recipe"):$("#select-partial-ultimate").appendTo("#select-partial-ultimate-chef")}),$('.main-nav a[data-toggle="tab"]').on("shown.bs.tab",function(e){"true"!=$(this).attr("data-init")&&($(".dataTables_scrollBody:visible table.dataTable").DataTable().draw(!1),updateScrollHeight())}),$(".dataTables_scrollBody table.dataTable").on("page.dt",function(){$(this).closest(".dataTables_scrollBody").scrollTop(0)}),$(".bootstrap-select").hover(function(){$(".bootstrap-select").removeClass("hover-item");var e=$(this);e.addClass("hover-item"),setTimeout(function(){!e.hasClass("open")&&e.hasClass("hover-item")&&e.find("select").selectpicker("toggle")},10)},function(){var e=$(this);e.removeClass("hover-item"),setTimeout(function(){e.hasClass("open")&&e.find("select").selectpicker("toggle")},10)}),monitorStyle(),window.location.href.indexOf("github")>0&&$(".loading h3").remove(),$(".loading").addClass("hidden"),$(".main-function").removeClass("hidden"),$("#recipe-table").DataTable().draw(!1),updateScrollHeight(),window.onresize=function(){$('.main-nav a[data-toggle="tab"]').attr("data-init","false"),updateScrollHeight(!0)}}function updateScrollHeight(e){var a=$("body").height()-$(".dataTables_scrollBody:visible").height(),t=$(window).height()-a-10+"px";$(".dataTables_scrollBody:visible").css("height")!=t&&($(".dataTables_scrollBody:visible").css("height",t),e=!0),e&&($(".dataTables_scrollBody:visible table.dataTable").DataTable().columns.adjust().draw(!1),$('.main-nav li.active a[data-toggle="tab"]').attr("data-init","true"))}function initTableResponsiveDisplayEvent(e){e.on("responsive-display",function(e,a,t,i,l){a.fixedColumns().relayout();var s=$(this).closest(".DTFC_ScrollWrapper"),r=s.find(".dataTables_scrollBody");if(i){var c=$(t.node()).next("tr");c.offset().top-r.offset().top+c.outerHeight()>=r.height()&&r.scrollTop(c.offset().top-r.offset().top+c.outerHeight()-r.height()+1+r.scrollTop())}s.find(".DTFC_LeftBodyLiner").scrollTop(r.scrollTop())})}function initTableScrollEvent(e){$(e).find(".dataTables_scrollBody").on("scroll",function(e){var a=$(this).closest(".DTFC_ScrollWrapper");a.find(".dataTables_scrollHeadInner th.fixedcolumn").offset().left-$(this).offset().left<0?a.find(".DTFC_LeftWrapper").css("display","block"):a.find(".DTFC_LeftWrapper").css("display","none"),a.find(".child-inner").css("margin-left",$(this).scrollLeft()+a.find(".DTFC_LeftWrapper").width()+"px")})}function initTooltip(){$('.tooltip-pin[data-toggle="tooltip"]').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),updateTooltip()}function updateTooltip(){$("#chk-setting-show-help").prop("checked")?($('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip({animation:!1,delay:{show:0,hide:0},trigger:"hover"}),$('[data-toggle="tooltip"]').on("show.bs.tooltip",function(){$('[data-toggle="tooltip"]').not(this).tooltip("hide")})):$('[data-toggle="tooltip"]:not(.tooltip-pin)').tooltip("destroy")}function initSetting(e){$("#chk-setting-show-help").change(function(){console.log("check loop change"),updateTooltip(),updateSettingLocalData()}),$("#chk-setting-expand").change(function(){$(this).prop("checked")||$("tr.child").remove(),initRecipeShow(),initChefShow(),initEquipShow(),initDecorationShow(),private&&(initCalChefsShow(),initCalEquipsShow(),initCalMaterialsShow()),updateSettingLocalData()}),$("#chk-setting-auto-update").change(function(){updateSettingLocalData()}),$("#chk-setting-show-final").change(function(){updateRecipeChefTable(e),updateSettingLocalData()}),$("#chk-setting-done-mark").change(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGuestInfo(i,i.rank);i.rankGuestsVal=l.rankGuestsVal,i.rankGuestsDisp=l.rankGuestsDisp;var s=getRankGiftInfo(i,i.rank);i.rankGiftVal=s.rankGiftVal,i.rankGiftDisp=s.rankGiftDisp,this.data(i)}),$("#recipe-table").DataTable().draw(!1),updateSettingLocalData()})}function initRecipeTable(e){for(var a in reInitRecipeTable(e),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){return e.nTable!=document.getElementById("recipe-table")||!!$('#chk-recipe-rarity option[value="'+i.rarity+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-skill").val();if(0==s.length)return!1;var r=$("#chk-recipe-multiple-skill").prop("checked");for(var c in s)if(i[""+s[c]]>0){if(!r)return!0}else if(r)return!1;return!!r}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-category").val();if(0==s.length)return!1;var r=$("#chk-recipe-multiple-category").prop("checked");for(var c in s)if(i[""+s[c]]){if(!r)return!0}else if(r)return!1;return!!r}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=Number($("#input-recipe-price").val());return i.oPrice>=s}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-guest").val();if(0==s.length)return!0;for(var r in s){if(i.guestsVal.indexOf(" "+s[r]+" ")>=0)return!0;if($("#chk-recipe-rank-guest").prop("checked")&&i.rankGuestsVal.indexOf(" "+s[r]+" ")>=0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-antique").val();if(0==s.length)return!0;for(var r in s){if(i.guestsVal.indexOf(s[r])>=0)return!0;if($("#chk-recipe-rank-antique").prop("checked")&&i.rankGiftVal.indexOf(s[r])>=0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-no-origin").prop("checked");return!!(s||!s&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-combo").prop("checked");return!!(!s||s&&i.comboVal)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-ex-no").prop("checked");return!(s&&(!s||i.ex))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$("#chk-recipe-got").prop("checked");return!!(!s||s&&i.got)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("recipe-table"))return!0;var s=$.trim($("#pane-recipes .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.materialsVal,s)||(!(!commaSeparatedMatch(i.origin,s)||-1!=i.origin.indexOf("神级"))||!!commaSeparatedMatch(i.tagsDisp,s)))}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,s){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(0==e.allSelectedMaterials.length)return!0;var r=$("#chk-recipe-multiple-material").prop("checked");for(var c in e.allSelectedMaterials){var n=!1;for(var o in l.materials)if(l.materials[o].material==e.allSelectedMaterials[c]){n=!0;break}if(n){if(!r)return!0}else if(r)return!1}return!!r}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,s){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(0==e.selectedQuests.length)return!0;for(var r in e.selectedQuests)if("修炼任务"==e.selectedQuests[r].type){var c=e.selectedQuests[r].conditions;for(var n in c)if(c[n].num){var o=getMaxLimit(e,c[n].rarity);return 2*o+l.limitVal>=c[n].num}break}return!0}),$.fn.dataTableExt.afnFiltering.push(function(a,t,i,l,s){if(a.nTable!=document.getElementById("recipe-table"))return!0;if(e.selectedQuests.length){for(var r in e.selectedQuests){var c=e.selectedQuests[r].conditions,n=!1;for(var o in c){var p=!0;if(c[o].recipeId&&c[o].recipeId!=l.recipeId&&(p=!1),c[o].materialId){var d=!1;for(var u in l.materials)if(l.materials[u].material==c[o].materialId){d=!0;break}d||(p=!1)}if(c[o].guest&&l.guestsVal.indexOf(c[o].guest)<0&&(!$("#chk-recipe-rank-guest").prop("checked")||l.rankGuestsVal.indexOf(c[o].guest)<0)&&(p=!1),(c[o].anyGuest||c[o].newGuest)&&(l.guestsVal||$("#chk-recipe-rank-guest").prop("checked")&&l.rankGuestsVal||(p=!1)),c[o].skill&&0==l[""+c[o].skill]&&(p=!1),c[o].rarity&&l.rarity<c[o].rarity&&(p=!1),c[o].price&&l.oPrice<c[o].price&&(p=!1),c[o].category&&(l[""+c[o].category]||(p=!1)),p){n=!0;break}}if(!n)return!1}return!0}return!0}),e.materials)$("#chk-recipe-show-material").append("<option value='"+e.materials[a].materialId+"'>"+e.materials[a].name+"</option>");for(var a in $("#chk-recipe-show-material").selectpicker().on("changed.bs.select",function(a,t,i,l){updateRecipeTableData(e),$(this).val().length&&$("#recipe-table").DataTable().order([30,"desc"]),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-material").click(function(){$("#recipe-table").DataTable().draw()}),e.chefs)$("#chk-recipe-show-chef").append("<option value='"+e.chefs[a].chefId+"'>"+e.chefs[a].name+"</option>");for(var a in $("#chk-recipe-show-chef").selectpicker().on("changed.bs.select",function(a,t,i,l){if($("#select-recipe-chef-quest").find('option:not([value=""])').remove(),1==$(this).val().length){var s=$(this).val()[0];for(var r in e.chefs)if(e.chefs[r].chefId==s){for(var c in e.chefs[r].ultimateGoal)for(var n in e.quests)if(e.chefs[r].ultimateGoal[c]==e.quests[n].questId){e.quests[n].hasOwnProperty("conditions")&&$("#select-recipe-chef-quest").append("<option value='"+e.quests[n].questId+"'>"+e.quests[n].goal+"</option>");break}break}}$("#select-recipe-chef-quest").selectpicker("refresh"),changeSelectStyle("#select-recipe-chef-quest"),updateRecipesChefsData(e),updateRecipeQuest(e,!0)}),$("#select-recipe-chef-quest").on("changed.bs.select",function(a,t,i,l){var s=!1;""!=l&&""!=$(this).val()||(updateRecipesChefsData(e),s=!0),l!=$(this).val()&&updateRecipeQuest(e,s)}),e.guests)$("#chk-recipe-guest").append("<option value='"+e.guests[a].name+"'>"+e.guests[a].name+"</option>");for(var t in $("#chk-recipe-guest").selectpicker().on("changed.bs.select",function(e,a,t,i){$("#recipe-table").DataTable().order([14,"asc"]).draw()}),$("#chk-recipe-rank-guest").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-guest").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGuestInfo(i,i.rank);i.rankGuestsVal=l.rankGuestsVal,i.rankGuestsDisp=l.rankGuestsDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-antique").selectpicker().on("changed.bs.select",function(){$("#recipe-table").DataTable().order([14,"asc"]).draw()}),$("#chk-recipe-rank-antique").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-filter-antique").click(function(){$("#recipe-table").DataTable().rows().every(function(e,a,t){var i=this.data(),l=getRankGiftInfo(i,i.rank);i.rankGiftVal=l.rankGiftVal,i.rankGiftDisp=l.rankGiftDisp,this.data(i)}),$("#recipe-table").DataTable().draw()}),e.activities)$("#select-recipe-quest").prepend("<optgroup label='"+e.activities[t].name+"'></optgroup>");for(var a in e.quests)if(e.quests[a].hasOwnProperty("conditions")){var i="<option value='"+e.quests[a].questId+"'>"+e.quests[a].questIdDisp+". "+e.quests[a].goal+"</option>";"修炼任务"!=e.quests[a].type&&$("#select-recipe-quest optgroup[label='"+e.quests[a].type+"']").append(i)}$("#select-recipe-quest").selectpicker().on("changed.bs.select",function(a,t,i,l){updateRecipeQuest(e)}),$("#chk-recipe-show").on("changed.bs.select",function(){initRecipeShow(),updateMenuLocalData()}),$("#chk-recipe-rarity").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-skill").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-skill").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-category").on("changed.bs.select",function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-multiple-category").click(function(){$("#recipe-table").DataTable().draw()}),$("#input-recipe-price").keyup(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-combo").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-ex-no").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-got").click(function(){$("#recipe-table").DataTable().draw()}),$("#chk-recipe-no-origin").click(function(){$("#recipe-table").DataTable().draw()}),$("#btn-recipe-reset").click(function(){$("#chk-recipe-rarity").selectpicker("selectAll"),$("#chk-recipe-skill").selectpicker("selectAll"),$("#chk-recipe-multiple-skill").prop("checked",!1),$("#chk-recipe-category").selectpicker("selectAll"),$("#chk-recipe-multiple-category").prop("checked",!1),$("#chk-recipe-combo").prop("checked",!1),$("#chk-recipe-ex-no").prop("checked",!1),$("#chk-recipe-got").prop("checked",!1),$("#chk-recipe-no-origin").prop("checked",!0),$("#input-recipe-price").val(""),$("#chk-recipe-guest").selectpicker("deselectAll"),$("#chk-recipe-rank-guest").prop("checked",!0),$("#chk-recipe-antique").selectpicker("deselectAll"),$("#chk-recipe-show-material").selectpicker("deselectAll"),$("#chk-recipe-multiple-material").prop("checked",!1),$("#pane-recipes .search-box input").val(""),$("#chk-recipe-show-chef").selectpicker("deselectAll"),$("#select-recipe-chef-quest").selectpicker("val",""),$("#select-recipe-quest").selectpicker("deselectAll"),$("#chk-chef-partial-ultimate").selectpicker("deselectAll"),checkMonitorStyle(),$("#recipe-table").DataTable().draw()}),$("#chk-recipe-apply-ex").change(function(){$(this).prop("checked")?$(".recipe-apply-ex").show():$(".recipe-apply-ex").hide(),updateRecipeChefTable(e)}),$("#chk-recipe-apply-ex-person").change(function(){updateRecipeChefTable(e)}),$("#btn-recipe-recal").click(function(){updateRecipeChefTable(e)}),initRecipeShow()}function updateRecipeQuest(e,a){$(".quest-warning").empty();var t=[],i=[],l=!1,s=[],r=!1,c=$("#select-recipe-quest").val(),n=$("#select-recipe-chef-quest").val();if(n.length&&c.push(n),c.length){var o="";for(var p in c)for(var d in e.quests)if(c[p]==e.quests[d].questId){for(var u in t.push(e.quests[d]),o+="["+e.quests[d].type+"] ","修炼任务"!=e.quests[d].type&&(o+=e.quests[d].questIdDisp+". "),o+=e.quests[d].goal+" ",e.quests[d].conditions){if(e.quests[d].conditions[u].newGuest&&(o=o.replace(/(新的)/g,"<span class='text-danger'>$1</span>")),2==e.quests[d].conditions[u].rank?o=o.replace(/(优级)/g,"<span class='text-danger'>$1</span>"):3==e.quests[d].conditions[u].rank?o=o.replace(/(特级)/g,"<span class='text-danger'>$1</span>"):4==e.quests[d].conditions[u].rank&&(o=o.replace(/(神级)/g,"<span class='text-danger'>$1</span>")),e.quests[d].conditions[u].num){o=o.replace(/(一次)/g,"<span class='text-danger'>$1</span>");var f=new RegExp("("+e.quests[d].conditions[u].num+"份)","g");o=o.replace(f,"<span class='text-danger'>$1</span>")}"修炼任务"==e.quests[d].type&&(4==e.quests[d].conditions[u].rank?r=!0:s=[14,"asc"]),e.quests[d].conditions[u].materialId&&e.quests[d].conditions[u].materialEff?(i.push(e.quests[d].conditions[u].materialId),s=[30,"desc"]):s=e.quests[d].conditions[u].materialEff?[19,"desc"]:e.quests[d].conditions[u].goldEff?[18,"desc"]:[14,"asc"]}break}$(".quest-warning").append(o),$(".quest-warning").removeClass("hidden")}else $(".quest-warning").addClass("hidden");e.selectedQuests=t,arraysEqual(e.questMaterials,i)||(e.questMaterials=i,l=!0),(l||a)&&updateRecipeTableData(e),r&&(s=[[e.recipeColNum+e.recipeAddColNum-2,"asc"],[14,"asc"]]),$("#recipe-table").DataTable().order(s).draw(),updateScrollHeight()}function reInitRecipeTable(e){var a=[{data:"galleryId",width:"1px"},{data:"icon",className:"td-recipe-icon",orderable:!1,searchable:!1},{data:"name",width:"86px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:"stirfry",width:"20px",orderSequence:["desc","asc"]},{data:"boil",width:"20px",orderSequence:["desc","asc"]},{data:"knife",width:"20px",orderSequence:["desc","asc"]},{data:"fry",width:"20px",orderSequence:["desc","asc"]},{data:"bake",width:"20px",orderSequence:["desc","asc"]},{data:"steam",width:"20px",orderSequence:["desc","asc"]},{data:{_:"materialsVal",display:"materialsDisp"}},{data:{_:"price",display:"priceDisp"},width:"30px",orderSequence:["desc","asc"]},{data:"exPrice",orderSequence:["desc","asc"]},{data:{_:"exTime",display:"exTimeDisp"},visible:private,className:"none"},{data:{_:"time",display:"timeDisp"}},{data:{_:"limitVal",display:"limitDisp"},orderSequence:["desc","asc"]},{data:"totalPrice",orderSequence:["desc","asc"]},{data:{_:"totalTime",display:"totalTimeDisp"}},{data:"efficiency",orderSequence:["desc","asc"]},{data:"allMaterialsEff",orderSequence:["desc","asc"]},{data:"origin"},{data:"unlock"},{data:{_:"comboVal",display:"comboDisp"}},{data:"tagsDisp",defaultContent:"",visible:private,className:"none"},{data:{_:"guestsVal",display:"guestsDisp"}},{data:{_:"rankGuestsVal",display:"rankGuestsDisp"}},{data:{_:"rankGiftVal",display:"rankGiftDisp"}},{data:"rank",className:"nodetails",width:"41px"},{data:"ex",className:"nodetails",width:"41px"},{data:"got",className:"nodetails",width:"41px"}],t=20,i="",l=[];$.fn.DataTable.isDataTable("#recipe-table")&&(t=$("#pane-recipes #recipe-table_length select").val(),i=$("#pane-recipes .search-box input").val(),l=getTableOrder($("#recipe-table").DataTable(),a.length),$("#recipe-table").DataTable().MakeCellsEditable("destroy"),$("#recipe-table").DataTable().destroy()),$("#recipe-table").html($("#recipe-table-header").html());for(var s=0;s<e.recipeAddColNumMax;s++)a.push({data:{_:"custom."+s+".value",display:"custom."+s+".display"},defaultContent:"",orderSequence:["desc","asc"],className:"never"}),$("#recipe-table thead tr").append("<th></th>");var r=$("#recipe-table").DataTable({data:e.recipes,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个菜谱",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个菜谱中过滤)"},pagingType:"numbers",lengthMenu:[[5,10,20,50,100,-1],[5,10,20,50,100,"所有"]],pageLength:t,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:l,autoWidth:!1,scrollX:!0,fixedColumns:{leftColumns:3},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l>4&&l<=9)continue;if(4==l){i+="<div class='col-lg-3 col-sm-6 col-xs-12'>";for(var s=4;s<=9;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(0==l||1==l?"":"：")+"</span><span class='child-value'>"+(t[l].data?t[l].data:27==l?"无":28==l||29==l?"否":"")+"</span></div>"}var r=$("#recipe-table").closest(".DTFC_ScrollWrapper"),c=r.find(".dataTables_scrollBody");return!!i&&"<div class='child-inner' style='max-width:"+c.width()+"px;margin-left:"+(c.scrollLeft()+r.find(".DTFC_LeftWrapper").width())+"px'>"+i+"</div>"}}}});$("#pane-recipes div.search-box").html('查找:<input type="search" value="'+i+'" class="form-control input-sm monitor-none" placeholder="菜名 材料 来源"></label>');var c=getRankOptions(),n=getGotOptions();r.MakeCellsEditable({columns:[27,28,29],inputTypes:[{column:27,type:"list",options:c},{column:28,type:"list",options:n},{column:29,type:"list",options:n}],onUpdate:function(a,t,i,l){if(27==i.index().column){var s=t.data(),c=getRankGuestInfo(s,s.rank);s.rankGuestsVal=c.rankGuestsVal,s.rankGuestsDisp=c.rankGuestsDisp;var n=getRankGiftInfo(s,s.rank);s.rankGiftVal=n.rankGiftVal,s.rankGiftDisp=n.rankGiftDisp,t.data(s),r.draw()}28==i.index().column&&i.data()!=l&&($("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-recipe-recal").closest(".inline-wrapper").removeClass("hidden")),updateRecipesLocalData()}}),$("#pane-recipes .search-box input").keyup(function(){r.draw(),changeInputStyle(this)}),initTableResponsiveDisplayEvent(r),initTableScrollEvent("#pane-recipes")}function updateRecipeTableData(e){e.allSelectedMaterials=[];var a=$("#chk-recipe-show-material").val();for(var t in a)e.allSelectedMaterials.push(Number(a[t]));for(var t in e.questMaterials)e.allSelectedMaterials.indexOf(e.questMaterials[t])<0&&e.allSelectedMaterials.push(e.questMaterials[t]);var i=$("#select-recipe-chef-quest").val(),l=$("#chk-recipe-show-chef").val();e.recipeAddColNum=2*l.length+(i.length>0?1:0)+e.allSelectedMaterials.length,e.recipeAddColNum>e.recipeAddColNumMax&&(e.recipeAddColNumMax=e.recipeAddColNum,reInitRecipeTable(e),initRecipeShow(),updateScrollHeight());for(t=0;t<e.recipeAddColNumMax;t++)$($("#recipe-table").DataTable().column(e.recipeColNum+t).header()).removeClass("all").addClass("never");for(var t in e.recipes){for(var s in e.recipes[t].custom=[],e.allSelectedMaterials){var r=0;for(var c in e.recipes[t].materials)if(e.recipes[t].materials[c].material==e.allSelectedMaterials[s]){r=e.recipes[t].materials[c].quantity;break}var n=0;e.recipes[t].time>0&&(n=3600*r/e.recipes[t].time);var o=n?Math.floor(n):"";e.recipes[t].custom.push({display:o,value:n})}for(var p=0;p<l.length;p++)e.recipes[t].custom.push({display:e.recipes[t].chefs[p].rankDisp,value:e.recipes[t].chefs[p].rankVal}),i.length&&e.recipes[t].custom.push({display:e.recipes[t].chefs[p].skillDiffDisp,value:e.recipes[t].chefs[p].skillDiffVal}),e.recipes[t].custom.push({display:e.recipes[t].chefs[p].efficiency,value:e.recipes[t].chefs[p].efficiency})}var d=0;for(var s in e.allSelectedMaterials)for(j in e.materials)if(e.allSelectedMaterials[s]==e.materials[j].materialId){$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text(e.materials[j].name+"/h").removeClass("never").addClass("all"),d++;break}for(var t in l)for(j in e.chefs)if(l[t]==e.chefs[j].chefId){$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text(e.chefs[j].name).removeClass("never").addClass("all"),d++,i.length&&($($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text("神差值").removeClass("never").addClass("all"),d++),$($("#recipe-table").DataTable().column(e.recipeColNum+d).header()).text("效率").removeClass("never").addClass("all"),d++;break}$("#recipe-table").DataTable().clear().rows.add(e.recipes),$("#recipe-table").DataTable().responsive.rebuild(),$("#recipe-table").DataTable().responsive.recalc(),$("#recipe-table").DataTable().columns.adjust()}function updateRecipesChefsData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=$("#select-recipe-chef-quest").val(),i=$("#chk-recipe-show-chef").val();if(i.length>0)for(var l in e.recipes)for(var s in e.recipes[l].chefs=[],i)for(var r in e.chefs)if(i[s]==e.chefs[r].chefId){var c=null;a&&(c=e.chefs[r].equip);var n=getRecipeResult(e.chefs[r],c,e.recipes[l],1,1,e.materials,null,0),o={};if(o.rankVal=n.rankVal,o.rankDisp=n.rankDisp,o.efficiency=n.chefEff||"",t.length){var p=getSkillDiff(e.chefs[r],e.recipes[l],4);o.skillDiffDisp=p.disp,o.skillDiffVal=p.value}e.recipes[l].chefs.push(o);break}}function getSkillDiff(e,a,t){var i=e.stirfryVal-a.stirfry*t,l=e.boilVal-a.boil*t,s=e.knifeVal-a.knife*t,r=e.fryVal-a.fry*t,c=e.bakeVal-a.bake*t,n=e.steamVal-a.steam*t,o="",p=0;i<0&&a.stirfry>0&&(o+="炒"+i+" ",p+=i),l<0&&a.boil>0&&(o+="煮"+l+" ",p+=l),s<0&&a.knife>0&&(o+="切"+s+" ",p+=s),r<0&&a.fry>0&&(o+="炸"+r+" ",p+=r),c<0&&a.bake>0&&(o+="烤"+c+" ",p+=c),n<0&&a.steam>0&&(o+="蒸"+n+" ",p+=n);var d={};return d.disp=o,d.value=-p,d}function updateChefTableData(e){var a=$("#chk-chef-show-skill-diff").prop("checked"),t=$("#chk-chef-show-recipe").val();e.chefAddColNum=t.length*(2+(a?1:0)),e.chefAddColNum>e.chefAddColNumMax&&(e.chefAddColNumMax=e.chefAddColNum,reInitChefTable(e),initChefShow(),updateScrollHeight());for(var i=0;i<e.chefAddColNumMax;i++)$($("#chef-table").DataTable().column(e.chefColNum+i).header()).removeClass("all").addClass("never");for(var i in e.chefs){e.chefs[i].custom=[];for(var l=0;l<t.length;l++)e.chefs[i].custom.push({display:e.chefs[i].recipes[l].rankDisp,value:e.chefs[i].recipes[l].rankVal}),a&&e.chefs[i].custom.push({display:e.chefs[i].recipes[l].skillDiffDisp,value:e.chefs[i].recipes[l].skillDiffVal}),e.chefs[i].custom.push({display:e.chefs[i].recipes[l].efficiency,value:e.chefs[i].recipes[l].efficiency})}var s=0;for(var i in t)for(j in e.recipes)if(t[i]==e.recipes[j].recipeId){$($("#chef-table").DataTable().column(e.chefColNum+s).header()).text(e.recipes[j].name).removeClass("never").addClass("all"),s++,a&&($($("#chef-table").DataTable().column(e.chefColNum+s).header()).text("神差值").removeClass("never").addClass("all"),s++),$($("#chef-table").DataTable().column(e.chefColNum+s).header()).text("效率").removeClass("never").addClass("all"),s++;break}t.length&&(order=a?[[e.chefColNum+1,"asc"],[e.chefColNum+2,"desc"]]:[e.chefColNum+1,"desc"],$("#chef-table").DataTable().order(order)),$("#chef-table").DataTable().clear().rows.add(e.chefs),$("#chef-table").DataTable().responsive.rebuild(),$("#chef-table").DataTable().responsive.recalc(),$("#chef-table").DataTable().columns.adjust()}function updateChefsRecipesData(e){var a=$("#chk-chef-apply-equips").prop("checked"),t=$("#chk-chef-show-skill-diff").prop("checked"),i=$("#chk-chef-show-recipe").val();if(i.length>0)for(var l in e.chefs)for(var s in e.chefs[l].recipes=[],i)for(var r in e.recipes)if(i[s]==e.recipes[r].recipeId){var c=null;a&&(c=e.chefs[l].equip);var n=getRecipeResult(e.chefs[l],c,e.recipes[r],1,1,e.materials,null,0),o={};if(o.rankVal=n.rankVal,o.rankDisp=n.rankDisp,o.efficiency=n.chefEff||"",t){var p=getSkillDiff(e.chefs[l],e.recipes[r],4);o.skillDiffDisp=p.disp,o.skillDiffVal=p.value}e.chefs[l].recipes.push(o)}}function getTableOrder(e,a){var t=[],i=e.order();for(var l in i){var s=i[l][0];s<a&&t.push(i[l])}return t}function initChefTable(e){for(var a in reInitChefTable(e),e.recipes)$("#chk-chef-show-recipe").append("<option value='"+e.recipes[a].recipeId+"'>"+e.recipes[a].name+"</option>");$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){return e.nTable!=document.getElementById("chef-table")||!!$('#chk-chef-rarity option[value="'+i.rarity+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){return e.nTable!=document.getElementById("chef-table")||!!$('#chk-chef-gender option[value="'+i.gender+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-category").val();if(0==s.length)return!0;var r=$("#chk-chef-category-equip").prop("checked"),c=i.specialSkillEffect.concat(i.ultimateSkillEffect);for(var n in r&&i.equip&&(c=c.concat(i.equip.effect)),s)for(var o in c)if(c[o].type==s[n]){if("OpenTime"!=c[o].type)return!0;if(c[o].value<0)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-no-origin").prop("checked");return!!(s||!s&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$("#chk-chef-got").prop("checked");return!!(!s||s&&i.got)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("chef-table"))return!0;var s=$.trim($("#pane-chefs .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.specialSkillDisp,s)||(!!commaSeparatedMatch(i.origin,s)||(!!commaSeparatedMatch(i.ultimateSkillDisp,s)||!!commaSeparatedMatch(i.tagsDisp,s))))}),$("#chk-chef-show-recipe").selectpicker().on("changed.bs.select",function(a,t,i,l){updateChefsRecipesData(e),updateChefTableData(e),$("#chef-table").DataTable().draw()}),$("#chk-chef-show-skill-diff").click(function(){$("#chk-chef-show-recipe").val().length&&(updateChefsRecipesData(e),updateChefTableData(e),$("#chef-table").DataTable().draw())}),$("#chk-chef-show").on("changed.bs.select",function(){initChefShow(),updateMenuLocalData()}),$("#chk-chef-rarity").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-gender").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-category").on("changed.bs.select",function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-category-equip").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-got").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-no-origin").click(function(){$("#chef-table").DataTable().draw()}),$("#chk-chef-apply-ultimate").change(function(){$(this).prop("checked")?$(".chef-apply-ultimate").show():$(".chef-apply-ultimate").hide(),updateRecipeChefTable(e)}),$("#chk-chef-apply-ultimate-person").change(function(){updateRecipeChefTable(e)}),$("#chk-chef-partial-ultimate").selectpicker().on("changed.bs.select",function(){updateRecipeChefTable(e)}),$("#chk-chef-apply-equips").change(function(){updateRecipeChefTable(e)}),$("#btn-chef-recal").click(function(){updateRecipeChefTable(e)}),$("#btn-chef-reset").click(function(){$("#chk-chef-rarity").selectpicker("selectAll"),$("#chk-chef-gender").selectpicker("selectAll"),$("#chk-chef-category").selectpicker("deselectAll"),$("#chk-chef-got").prop("checked",!1),$("#chk-chef-no-origin").prop("checked",!0),$("#chk-chef-show-recipe").selectpicker("deselectAll"),$("#pane-chefs .search-box input").val(""),$("#chk-chef-partial-ultimate").selectpicker("deselectAll"),checkMonitorStyle(),$("#chef-table").DataTable().draw()}),initChefShow()}function reInitChefTable(e){var a=[{data:"galleryId",width:"1px"},{data:"icon",className:"td-chef-icon",orderable:!1,searchable:!1},{data:"name",width:"81px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fryVal",
display:"fryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:{_:"meatVal",display:"meatDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"creationVal",display:"creationDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"vegVal",display:"vegDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fishVal",display:"fishDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"gender",width:"30px"},{data:"origin"},{data:"tagsDisp",defaultContent:"",visible:private,className:"none"},{data:{_:"equipName",display:"equipDisp"},className:"nodetails"},{data:"ultimateGoalDisp"},{data:"ultimateSkillDisp"},{data:"ultimate",className:"nodetails",width:"41px"},{data:"got",className:"nodetails",width:"41px"}],t=20,i="",l=[];$.fn.DataTable.isDataTable("#chef-table")&&(t=$("#pane-chefs #chef-table_length select").val(),i=$("#pane-chefs .search-box input").val(),l=getTableOrder($("#chef-table").DataTable(),a.length),$("#chef-table").DataTable().MakeCellsEditable("destroy"),$("#chef-table").DataTable().destroy()),$("#chef-table").html($("#chef-table-header").html());for(var s=0;s<e.chefAddColNumMax;s++)a.push({data:{_:"custom."+s+".value",display:"custom."+s+".display"},defaultContent:"",orderSequence:["desc","asc"],className:"never"}),$("#chef-table thead tr").append("<th></th>");var r=$("#chef-table").DataTable({data:e.chefs,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨师",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨师中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:t,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,order:l,autoWidth:!1,scrollX:!0,fixedColumns:{leftColumns:3},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l>4&&l<=9)continue;if(4==l){i+="<div class='col-lg-3 col-sm-6 col-xs-12'>";for(var s=4;s<=9;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else{if(l>11&&l<=14)continue;if(11==l){i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>采集：</span>";for(s=11;s<=14;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(0==l||1==l?"":"：")+"</span><span class='child-value'>"+(t[l].data?t[l].data:18==l?"无":21==l||22==l?"否":"")+"</span></div>"}}var r=$("#chef-table").closest(".DTFC_ScrollWrapper"),c=r.find(".dataTables_scrollBody");return!!i&&"<div class='child-inner' style='max-width:"+c.width()+"px;margin-left:"+(c.scrollLeft()+r.find(".DTFC_LeftWrapper").width())+"px'>"+i+"</div>"}}}});$("#pane-chefs div.search-box").html('<label>查找:<input type="search" value="'+i+'" class="form-control input-sm monitor-none" placeholder="名字 技能 来源"></label>');var c=getGotOptions(),n=getEquipsOptions(e.equips,e.skills);r.MakeCellsEditable({columns:[18,21,22],inputTypes:[{column:18,type:"list",search:!0,clear:!0,options:n},{column:21,type:"list",options:c},{column:22,type:"list",options:c}],onUpdate:function(a,t,i,l){if(18==i.index().column){var s=t.data(),c=null,n="";if(s.equipName)for(var o in e.equips)if(s.equipName==e.equips[o].name){c=e.equips[o],n=e.equips[o].name+"<br>"+e.equips[o].skillDisp;break}s.equip=c,s.equipDisp=n,t.data(s),r.draw()}18!=i.index().column&&21!=i.index().column||i.data()==l||($("#chk-setting-auto-update").prop("checked")?updateRecipeChefTable(e):$("#btn-chef-recal").closest(".inline-wrapper").removeClass("hidden")),updateChefsLocalData()}}),$("#pane-chefs .search-box input").keyup(function(){r.draw(),changeInputStyle(this)}),initTableResponsiveDisplayEvent(r),initTableScrollEvent("#pane-chefs")}function initEquipTable(e){var a=[{data:"galleryId",width:"1px"},{data:"icon",className:"td-equip-icon",orderable:!1,searchable:!1},{data:"name",width:"80px",className:"all fixedcolumn"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:{_:"skillDisp",sort:"skillSort"},type:"num"},{data:"origin"}],t=$("#equip-table").DataTable({data:e.equips,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个厨具",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个厨具中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,autoWidth:!1,scrollX:!0,fixedColumns:{leftColumns:3},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)t[l].hidden&&(i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(0==l||1==l?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>");var s=$("#equip-table").closest(".DTFC_ScrollWrapper"),r=s.find(".dataTables_scrollBody");return!!i&&"<div class='child-inner' style='max-width:"+r.width()+"px;margin-left:"+(r.scrollLeft()+s.find(".DTFC_LeftWrapper").width())+"px'>"+i+"</div>"}}}});$("#pane-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=i.effect,r=$("#chk-equip-skill").val(),c=$("#chk-equip-multiple-skill").prop("checked"),n=!1;for(var o in(1==r.length||c)&&(n=$("#chk-equip-filter-negative-skill").prop("checked")),r){var p=!0,d=r[o].split(",");for(var u in d){var f=!1;for(var h in s)if(s[h].type==d[u]){if(n&&s[h].value<0)return!1;f=!0;break}if(!f){if(c)return!1;p=!1;break}}if(!c&&p)return!0}return!!c}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$("#chk-equip-filter-all-skill").prop("checked");if(!s)return!0;var r=i.effect,c="Stirfry,Boil,Knife,Fry,Bake,Steam",n=c.split(",");for(var o in n){var p=!1;for(var d in r)if(r[d].type==n[o]){p=!0;break}if(!p)return!0}return!1}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$("#chk-equip-no-origin").prop("checked");return!!(s||!s&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("equip-table"))return!0;var s=$.trim($("#pane-equips .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.skillDisp,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-equip-show").on("changed.bs.select",function(){initEquipShow(),updateMenuLocalData()}),$("#chk-equip-skill").selectpicker({countSelectedText:function(e,a){return e<a?e+"/"+a+" 类型":"全类型"}}).on("changed.bs.select",function(){var e="";1==$(this).val().length&&(e=$(this).val()[0],t.order([4,"desc"])),t.rows().every(function(a,t,i){var l=this.data();if(""==e)l.skillSort=0;else for(var s in l.effect)if((l.effect[s].type==e||e.indexOf(",")>0&&e.split(",")[0]==l.effect[s].type)&&(l.skillSort=l.effect[s].value,"Percent"==l.effect[s].cal)){l.skillSort*=1e4;break}this.data(l)}),t.draw()}),$("#chk-equip-no-origin").click(function(){t.draw()}),$("#chk-equip-multiple-skill").click(function(){t.draw()}),$("#chk-equip-filter-negative-skill").click(function(){t.draw()}),$("#chk-equip-filter-all-skill").click(function(){t.draw()}),$("#pane-equips .search-box input").keyup(function(){t.draw(),changeInputStyle(this)}),$("#btn-equip-reset").click(function(){$("#chk-equip-skill").selectpicker("selectAll"),$("#chk-equip-multiple-skill").prop("checked",!1),$("#chk-equip-filter-negative-skill").prop("checked",!1),$("#chk-equip-filter-all-skill").prop("checked",!1),$("#chk-equip-no-origin").prop("checked",!0),$("#pane-equips .search-box input").val(""),checkMonitorStyle(),t.draw()}),initTableResponsiveDisplayEvent(t),initTableScrollEvent("#pane-equips"),initEquipShow()}function initDecorationTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"id",width:"1px"},{data:"icon",className:"td-equip-icon",orderable:!1,searchable:!1},{data:"name",width:"145px",className:"all fixedcolumn"},{data:{_:"gold",display:"goldDisp"},orderSequence:["desc","asc"]},{data:"tipMin",orderSequence:["desc","asc"]},{data:"tipMax",orderSequence:["desc","asc"]},{data:{_:"tipTime",display:"tipTimeDisp"},orderSequence:["desc","asc"]},{data:"minEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"maxEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"avgEff",defaultContent:"-",orderSequence:["desc","asc"]},{data:"position"},{data:{_:"suit",display:"suitDisp"},orderSequence:["desc","asc"]},{data:{_:"suitGold",display:"suitGoldDisp"},orderSequence:["desc","asc"]},{data:"origin"}],t=$("#decoration-table").DataTable({data:e.decorations,columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个装饰",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个装饰中过滤)",select:{rows:{_:"选择了 %d 个装饰",0:"",1:"选择了 %d 个装饰"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[0,"desc"],[10,"desc"]],deferRender:!1,autoWidth:!1,scrollX:!0,fixedColumns:{leftColumns:4},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)t[l].hidden&&(i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(1==l||2==l?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>");var s=$("#decoration-table").closest(".DTFC_ScrollWrapper"),r=s.find(".dataTables_scrollBody");return!!i&&"<div class='child-inner' style='max-width:"+r.width()+"px;margin-left:"+(r.scrollLeft()+s.find(".DTFC_LeftWrapper").width())+"px'>"+i+"</div>"}}}});$("#pane-decorations div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="名字 套装 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var s=i.position;return!!$('#chk-decoration-position option[value="'+s+'"]').is(":selected")}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var s=$("#chk-decoration-no-origin").prop("checked");return!!(s||!s&&i.origin)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("decoration-table"))return!0;var s=$.trim($("#pane-decorations .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.suit,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-decoration-show").on("changed.bs.select",function(){initDecorationShow(),updateMenuLocalData()}),$("#chk-decoration-position").selectpicker({countSelectedText:function(e,a){return e<a?e+"/"+a+" 位置":"全位置"}}).on("changed.bs.select",function(){t.draw()}),$("#chk-decoration-no-origin").click(function(){t.draw()}),$("#pane-decorations .search-box input").keyup(function(){t.draw(),changeInputStyle(this)});var i="<option></option>";for(var l in e.suits)i+="<option value='"+e.suits[l].name+"'>"+e.suits[l].name+"</option>";$("#select-decoration-suit").append(i).selectpicker().change(function(){var e=$("#select-decoration-suit").val();$("#select-decoration-suit").selectpicker("val",""),t.rows().deselect(),t.rows().every(function(a,t,i){this.data().suit==e&&this.select()}),t.draw()}),$("#btn-decoration-deselect-all").click(function(){$("#select-decoration-suit").selectpicker("val",""),t.rows().deselect()}),t.on("user-select",function(e,a,i,l,s){var r=l.index().row,c=t.rows(r).data()[0];t.rows({selected:!0}).every(function(e,a,t){this.data().position==c.position&&this.data().id!=c.id&&this.deselect()})}),t.on("select",function(a,t,i,l){updateDecorationSum(e)}),t.on("deselect",function(a,t,i,l){updateDecorationSum(e)}),initTableResponsiveDisplayEvent(t),initTableScrollEvent("#pane-decorations"),initDecorationShow()}function updateDecorationSum(e){var a=$("#decoration-table").DataTable().rows({selected:!0}).data().toArray(),t=0,i=0,l=[];for(var s in a)a[s].suit&&l.indexOf(a[s].suit)<0&&l.push(a[s].suit),a[s].avgEff&&(t+=a[s].avgEff),i+=a[s].gold;var r=0;for(var s in l)r+=getSuitGold(e,a,l[s]);var c="";a.length&&(c="平均玉璧/天:"+ +t.toFixed(1)+" 收入加成: "+getPercentDisp(+(100*(i+r)).toFixed(2))),$("#decoration-sum").html(c)}function getSuitGold(e,a,t){for(var i in e.suits)if(e.suits[i].name==t){for(var l in e.suits[i].decorations){var s=!1;for(var r in a)if(e.suits[i].decorations[l]==a[r].id){s=!0;break}if(!s)return 0}return e.suits[i].gold}return 0}function initMaterialTable(e){for(var a in e.maps)$("#select-material-origin").append("<option value='"+e.maps[a].name+"'>"+e.maps[a].name+"</option>");reInitMaterialTable(e),$("#select-material-origin").selectpicker().change(function(){reInitMaterialTable(e)}),$("#chk-material-season").click(function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()}),$("#input-material-addition, #input-material-skill").keyup(function(){var a=getMaterialsData(e);$("#material-table").DataTable().clear().rows.add(a).draw()})}function reInitMaterialTable(e){var a=[{data:"name",className:"fixedcolumn"},{data:"skill",defaultContent:""}];$.fn.DataTable.isDataTable("#material-table")&&$("#material-table").DataTable().destroy();var t,i=$("#select-material-origin").val();for(var l in e.maps)if(i==e.maps[l].name){t=e.maps[l];break}for(var l in $("#material-table thead tr").first().html("").append("<th rowspan='2'>食材</th><th rowspan='2'>点数</th>"),$("#material-table thead tr").last().html(""),t.time)$("#material-table thead tr").first().append("<th colspan='2'>"+secondsToTime(t.time[l])+"</th>"),$("#material-table thead tr").last().append("<th>最小</th><th>最大</th>"),a.push({data:"time."+l+".0"}),a.push({data:"time."+l+".1"});var s=getMaterialsData(e,t),r=$("#material-table").DataTable({data:s,columns:a,dom:"<'row'<'col-sm-12'tr>>",paging:!1,ordering:!1,info:!1,deferRender:!0,autoWidth:!1,scrollX:!0,fixedColumns:{leftColumns:1}});initTableScrollEvent("#pane-materials"),r.draw()}function initQuestTable(e){for(var a in e.activities)$("#select-quest-type").append("<option>"+e.activities[a].name+"</option>");var t=[{data:"questIdDisp",width:"25px",className:"fixedcolumn"},{data:"preId",defaultContent:"",orderable:!1,width:"35px"},{data:"goal"},{data:{_:"rewardsVal",display:"rewardsDisp"}}],i=getQuestsData(e.quests,$("#select-quest-type").val()),l=$("#quest-table").DataTable({data:i,columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"第 _PAGE_ 页 共 _PAGES_ 页 _TOTAL_ 个任务",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 个任务中过滤)"},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",deferRender:!0,autoWidth:!1,scrollX:!0,fixedColumns:{leftColumns:1}});$("#pane-quest div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="编号 任务 奖励"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("quest-table"))return!0;var s=$.trim($("#pane-quest .search-box input").val());return!!commaSeparatedMatch(i.questIdDisp.toString(),s)||(!!commaSeparatedMatch(i.goal,s)||!!commaSeparatedMatch(i.rewardsVal,s))}),$("#pane-quest .search-box input").keyup(function(){l.draw(),changeInputStyle(this)}),$("#select-quest-type").selectpicker().change(function(){var a=getQuestsData(e.quests,$(this).val());l.clear().rows.add(a).draw(),initQuestShow(l)}),initTableScrollEvent("#pane-quest"),initQuestShow(l)}function initImportExport(e){$("#btn-export").click(function(){$("#input-export-import").val(generateExportData())}),$("#btn-import").click(function(){$("#import-msg-2").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=importData(e,$("#input-export-import").val());a?($("#input-export-import").val(""),$("#import-msg-2").html("导入成功 !")):$("#import-msg-2").html("导入失败 !")},0)}),$("#btn-export-download").click(function(){var e=new Blob([generateExportData()],{type:"text/plain;charset=utf-8"});saveAs(e,"food.txt")}),$("#file-import").change(function(){$("#import-msg").html("导入中...").removeClass("hidden"),setTimeout(function(){var a=document.getElementById("file-import").files[0],t=new FileReader;t.onload=function(a){var t=importData(e,a.target.result);t?$("#import-msg").html("导入成功 !"):$("#import-msg").html("导入失败 !")},t.readAsText(a,"UTF-8"),$(this).val("")},0)})}function importData(e,a){var t;try{t=JSON.parse(a)}catch(e){return!1}for(var i in e.recipes){for(var l in t.recipes)if(e.recipes[i].recipeId==t.recipes[l].id){if(t.recipes[l].hasOwnProperty("rank")){e.recipes[i].rank=t.recipes[l].rank;var s=getRankGuestInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGuestsVal=s.rankGuestsVal,e.recipes[i].rankGuestsDisp=s.rankGuestsDisp;var r=getRankGiftInfo(e.recipes[i],e.recipes[i].rank);e.recipes[i].rankGiftVal=r.rankGiftVal,e.recipes[i].rankGiftDisp=r.rankGiftDisp}t.recipes[l].hasOwnProperty("ex")&&(e.recipes[i].ex=t.recipes[l].ex),t.recipes[l].hasOwnProperty("got")&&(e.recipes[i].got=t.recipes[l].got);break}for(var l in t.recipesTags)if(e.recipes[i].recipeId==t.recipesTags[l].recipeId){e.recipes[i].tags=t.recipesTags[l].tags,e.recipes[i].tagsDisp=getTagsDisp(t.recipesTags[l].tags,t.tags),e.recipes[i].exTime=t.recipesTags[l].experienceTime,e.recipes[i].exTimeDisp=getExTimeDisp(t.recipesTags[l].experienceTime,e.recipes[i].time);break}}for(var i in e.chefs){for(var l in t.chefs)if(e.chefs[i].chefId==t.chefs[l].id){if(t.chefs[l].hasOwnProperty("got")&&(e.chefs[i].got=t.chefs[l].got),t.chefs[l].hasOwnProperty("ult")&&(e.chefs[i].ultimate=t.chefs[l].ult),t.chefs[l].hasOwnProperty("equip")){for(var c in e.equips)if(t.chefs[l].equip==e.equips[c].equipId){e.chefs[i].equip=e.equips[c],e.chefs[i].equipName=e.equips[c].name,e.chefs[i].equipDisp=e.equips[c].name+"<br>"+e.equips[c].skillDisp;break}}else e.chefs[i].equip=null;break}for(var l in t.chefsTags)if(e.chefs[i].chefId==t.chefsTags[l].chefId){e.chefs[i].tags=t.chefsTags[l].tags,e.chefs[i].tagsDisp=getTagsDisp(t.chefsTags[l].tags,t.tags);break}}var n="";for(var i in t.rules){var o=!1;for(var l in e.rules)if(t.rules[i].Id==e.rules[l].Id){e.rules[l]=t.rules[i],o=!0;break}o||(e.rules.push(t.rules[i]),n+="<option value='"+t.rules[i].Id+"'>"+t.rules[i].Title+"</option>")}$("#select-cal-rule").append(n).selectpicker("refresh"),t.calEquips&&($("#cal-equips-table").DataTable().rows().deselect(),$("#cal-equips-table").DataTable().rows(function(e,a,i){for(var l in t.calEquips)if(a.equipId==t.calEquips[l])return!0;return!1}).select()),updateMenu(t),updateSetting(t),t.decorationEffect&&(e.decorationEffect=t.decorationEffect,$("#input-cal-decoration").val(t.decorationEffect||""));try{localStorage.setItem("data",generateExportData())}catch(e){}return e=getUpdateData(e),updateRecipeTableData(e),updateChefTableData(e),initRecipeShow(),initChefShow(),initEquipShow(),!0}function updateRecipesLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.recipes=generateRecipesExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateChefsLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.chefs=generateChefsExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateMenuLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.menu=generateMenuExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateSettingLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.setting=generateSettingExportData();try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateDecorationLocalData(){var e;try{var a=localStorage.getItem("data");e=JSON.parse(a)}catch(e){}e||(e={}),e.decorationEffect=Number($("#input-cal-decoration").val());try{localStorage.setItem("data",JSON.stringify(e))}catch(e){}}function updateLocalData(e,a){var t;try{var i=localStorage.getItem("data");t=JSON.parse(i)}catch(e){}t||(t={}),t[e]=a;try{localStorage.setItem("data",JSON.stringify(t))}catch(e){}}function generateExportData(){var e={};return e.recipes=generateRecipesExportData(),e.chefs=generateChefsExportData(),e.menu=generateMenuExportData(),e.setting=generateSettingExportData(),e.decorationEffect=Number($("#input-cal-decoration").val()),JSON.stringify(e)}function generateRecipesExportData(){var e=[],a=$("#recipe-table").DataTable().data().toArray();for(var t in a){var i={};i.id=a[t].recipeId,i.rank=a[t].rank,i.ex=a[t].ex,i.got=a[t].got,e.push(i)}return e}function generateChefsExportData(){var e=[],a=$("#chef-table").DataTable().data().toArray();for(var t in a){var i={};i.id=a[t].chefId,i.got=a[t].got,i.ult=a[t].ultimate,a[t].equip&&(i.equip=a[t].equip.equipId),e.push(i)}return e}function generateMenuExportData(){var e={version:1};return e.recipe=$("#chk-recipe-show").val(),e.chef=$("#chk-chef-show").val(),e.equip=$("#chk-equip-show").val(),e.decoration=$("#chk-decoration-show").val(),e}function updateMenu(e){e&&e.menu&&1==e.menu.version&&($("#chk-recipe-show").selectpicker("val",e.menu.recipe),$("#chk-chef-show").selectpicker("val",e.menu.chef),$("#chk-equip-show").selectpicker("val",e.menu.equip),$("#chk-decoration-show").selectpicker("val",e.menu.decoration))}function generateSettingExportData(){var e={};return e.help=$("#chk-setting-show-help").prop("checked"),e.expand=$("#chk-setting-expand").prop("checked"),e.auto=$("#chk-setting-auto-update").prop("checked"),e.final=$("#chk-setting-show-final").prop("checked"),e.mark=$("#chk-setting-done-mark").prop("checked"),e}function updateSetting(e){e&&e.setting&&($("#chk-setting-show-help").prop("checked")!=e.setting.help&&(e.setting.help?$("#chk-setting-show-help").bootstrapToggle("on"):$("#chk-setting-show-help").bootstrapToggle("off")),$("#chk-setting-expand").prop("checked")!=e.setting.expand&&(e.setting.expand?$("#chk-setting-expand").bootstrapToggle("on"):$("#chk-setting-expand").bootstrapToggle("off")),$("#chk-setting-auto-update").prop("checked")!=e.setting.auto&&(e.setting.auto?$("#chk-setting-auto-update").bootstrapToggle("on"):$("#chk-setting-auto-update").bootstrapToggle("off")),$("#chk-setting-show-final").prop("checked")!=e.setting.final&&(e.setting.final?$("#chk-setting-show-final").bootstrapToggle("on"):$("#chk-setting-show-final").bootstrapToggle("off")),$("#chk-setting-done-mark").prop("checked")!=e.setting.mark&&(e.setting.mark?$("#chk-setting-done-mark").bootstrapToggle("on"):$("#chk-setting-done-mark").bootstrapToggle("off")))}function initCalTables(e){setSelfUltimateOptions(e.chefs,e.skills),setExOptions(e.recipes),initCalResultsTable(e),initCalRules(e),private&&($("#pane-cal").addClass("admin"),initCalChefsTable(e),initCalEquipsTable(e),initCalMaterialsTable(e),$("#input-cal-thread").val(navigator.hardwareConcurrency))}function initCalRules(e){var a="";for(var t in e.rules)a+="<option value='"+e.rules[t].Id+"'>"+e.rules[t].Title+"</option>";$("#select-cal-rule").append(a).selectpicker().change(function(){$("#btn-cal-rule-load").removeClass("btn-default").addClass("btn-danger")}),$("#input-cal-decoration").val(e.decorationEffect||""),loadUltimate(e,!0),$("#btn-cal-rule-load").click(function(){var a=Math.floor($("#select-cal-rule").val());for(var t in e.rules)if(e.rules[t].Id==a){currentRule=e.rules[t];break}currentRule&&($("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),$(".cal-results-wrapper").addClass("hidden"),setTimeout(function(){loadRule(e,currentRule),setCalConfigData(currentRule,e),initCalCustomOptions(currentRule,e),$(".loading").addClass("hidden"),$(".cal-menu").removeClass("hidden"),$("#pane-cal-self-select .cal-results-wrapper").removeClass("hidden"),$("#pane-cal-recipes-results .cal-results-wrapper").removeClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1).removeClass("btn-danger").addClass("btn-default")},0))}),$("#btn-cal-update").click(function(){$("#btn-cal-decoration").prop("disabled",!0),$("#btn-cal-rule-load").prop("disabled",!0),$(".loading").removeClass("hidden"),$(".cal-results-wrapper").addClass("hidden"),setTimeout(function(){setCalConfigData(currentRule,e),calCustomResults(currentRule,e),$(".loading").addClass("hidden"),$("#pane-cal-self-select .cal-results-wrapper").removeClass("hidden"),$("#pane-cal-recipes-results .cal-results-wrapper").removeClass("hidden"),$("#btn-cal-rule-load").prop("disabled",!1),$("#btn-cal-decoration").prop("disabled",!1)},0)}),$("#input-cal-decoration").keyup(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),updateDecorationLocalData()}),$("#cal-ultimate input").keyup(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#chk-cal-partial-ultimate").selectpicker().on("changed.bs.select",function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#chk-cal-self-ultimate").selectpicker().on("changed.bs.select",function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#chk-cal-ex").selectpicker().on("changed.bs.select",function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger")}),$("#btn-cal-load-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),loadUltimate(e,!0)}),$("#btn-cal-load-all-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),loadUltimate(e,!1)}),$("#btn-cal-clear-ultimate").click(function(){$("#btn-cal-update").removeClass("btn-default").addClass("btn-danger"),$("#cal-ultimate input").val(""),$("#chk-cal-partial-ultimate").selectpicker("deselectAll"),$("#chk-cal-self-ultimate").selectpicker("deselectAll"),$("#chk-cal-ex").selectpicker("deselectAll")}),$("#chk-cal-got").click(function(){$("#cal-recipes-results-table").DataTable().draw(),initCalCustomOptions(currentRule,e)}),$("#chk-cal-no-origin").click(function(){$("#cal-recipes-results-table").DataTable().draw(),initCalCustomOptions(currentRule,e)}),$("#select-cal-order").change(function(){initCalCustomOptions(currentRule,e),sortRecipesResult()}),$("#btn-cal-clear-custom").click(function(){var a=$("#cal-self-select-table").DataTable(),t=a.data().toArray();for(var i in t)t[i].chef.name="",t[i].equip.name="",t[i].recipe.data.name="";calCustomResults(currentRule,e)})}function loadUltimate(e,a){var t;try{var i=localStorage.getItem("data");t=JSON.parse(i)}catch(e){}var l=getUltimateData(e.chefs,t,e.skills,!0,a),s=l.global;for(var r in s)"Stirfry"!=s[r].type||s[r].tag?"Boil"!=s[r].type||s[r].tag?"Knife"!=s[r].type||s[r].tag?"Fry"!=s[r].type||s[r].tag?"Bake"!=s[r].type||s[r].tag?"Steam"!=s[r].type||s[r].tag?1!=s[r].tag?2!=s[r].tag?"MaxEquipLimit"!=s[r].type||1!=s[r].rarity?"MaxEquipLimit"!=s[r].type||2!=s[r].rarity?"MaxEquipLimit"!=s[r].type||3!=s[r].rarity?"MaxEquipLimit"!=s[r].type||4!=s[r].rarity?"MaxEquipLimit"!=s[r].type||5!=s[r].rarity?"UseAll"!=s[r].type||2!=s[r].rarity?"UseAll"!=s[r].type||3!=s[r].rarity?"UseAll"!=s[r].type||4!=s[r].rarity?"UseAll"!=s[r].type||5!=s[r].rarity?"Material_Gain"!=s[r].type&&console.log(s[r].type):$("#input-cal-ultimate-5-price").val(s[r].value):$("#input-cal-ultimate-4-price").val(s[r].value):$("#input-cal-ultimate-3-price").val(s[r].value):$("#input-cal-ultimate-2-price").val(s[r].value):$("#input-cal-ultimate-5-limit").val(s[r].value):$("#input-cal-ultimate-4-limit").val(s[r].value):$("#input-cal-ultimate-3-limit").val(s[r].value):$("#input-cal-ultimate-2-limit").val(s[r].value):$("#input-cal-ultimate-1-limit").val(s[r].value):$("#input-cal-ultimate-female-skill").val(s[r].value):$("#input-cal-ultimate-male-skill").val(s[r].value):$("#input-cal-ultimate-steam").val(s[r].value):$("#input-cal-ultimate-bake").val(s[r].value):$("#input-cal-ultimate-fry").val(s[r].value):$("#input-cal-ultimate-knife").val(s[r].value):$("#input-cal-ultimate-boil").val(s[r].value):$("#input-cal-ultimate-stirfry").val(s[r].value);var c=l.partial,n=[];for(var r in c)n.push(c[r].chefId);$("#chk-cal-partial-ultimate").selectpicker("val",n);var o=l.self,p=[];for(var r in o)p.push(o[r].chefId);$("#chk-cal-self-ultimate").selectpicker("val",p);var d=[];for(var r in e.recipes)(a&&"是"==e.recipes[r].ex||!a)&&d.push(e.recipes[r].recipeId);$("#chk-cal-ex").selectpicker("val",d)}function setCalConfigData(e,a){$("#btn-cal-update").removeClass("btn-danger").addClass("btn-default"),e.decorationEffect=Number($("#input-cal-decoration").val());var t=[],i=Number($("#input-cal-ultimate-stirfry").val());if(i){var l={type:"Stirfry"};l.value=i,l.condition="Global",l.cal="Abs",t.push(l)}var s=Number($("#input-cal-ultimate-boil").val());if(s){l={type:"Boil"};l.value=s,l.condition="Global",l.cal="Abs",t.push(l)}var r=Number($("#input-cal-ultimate-knife").val());if(r){l={type:"Knife"};l.value=r,l.condition="Global",l.cal="Abs",t.push(l)}var c=Number($("#input-cal-ultimate-fry").val());if(c){l={type:"Fry"};l.value=c,l.condition="Global",l.cal="Abs",t.push(l)}var n=Number($("#input-cal-ultimate-bake").val());if(n){l={type:"Bake"};l.value=n,l.condition="Global",l.cal="Abs",t.push(l)}var o=Number($("#input-cal-ultimate-steam").val());if(o){l={type:"Steam"};l.value=o,l.condition="Global",l.cal="Abs",t.push(l)}var p=Number($("#input-cal-ultimate-male-skill").val());if(p){var d={type:"Stirfry"};d.value=p,d.condition="Global",d.cal="Abs",d.tag=1,t.push(d);var u={type:"Boil"};u.value=p,u.condition="Global",u.cal="Abs",u.tag=1,t.push(u);var f={type:"Knife"};f.value=p,f.condition="Global",f.cal="Abs",f.tag=1,t.push(f);var h={type:"Fry"};h.value=p,h.condition="Global",h.cal="Abs",h.tag=1,t.push(h);var m={type:"Bake"};m.value=p,m.condition="Global",m.cal="Abs",m.tag=1,t.push(m);var b={type:"Steam"};b.value=p,b.condition="Global",b.cal="Abs",b.tag=1,t.push(b)}var v=Number($("#input-cal-ultimate-female-skill").val());if(v){d={type:"Stirfry"};d.value=v,d.condition="Global",d.cal="Abs",d.tag=2,t.push(d);u={type:"Boil"};u.value=v,u.condition="Global",u.cal="Abs",u.tag=2,t.push(u);f={type:"Knife"};f.value=v,f.condition="Global",f.cal="Abs",f.tag=2,t.push(f);h={type:"Fry"};h.value=v,h.condition="Global",h.cal="Abs",h.tag=2,t.push(h);m={type:"Bake"};m.value=v,m.condition="Global",m.cal="Abs",m.tag=2,t.push(m);b={type:"Steam"};b.value=v,b.condition="Global",b.cal="Abs",b.tag=2,t.push(b)}var g=Number($("#input-cal-ultimate-1-limit").val());if(g){l={type:"MaxEquipLimit"};l.value=g,l.condition="Global",l.cal="Abs",l.rarity=1,t.push(l)}var k=Number($("#input-cal-ultimate-2-limit").val());if(k){l={type:"MaxEquipLimit"};l.value=k,l.condition="Global",l.cal="Abs",l.rarity=2,t.push(l)}var y=Number($("#input-cal-ultimate-3-limit").val());if(y){l={type:"MaxEquipLimit"};l.value=y,l.condition="Global",l.cal="Abs",l.rarity=3,t.push(l)}var w=Number($("#input-cal-ultimate-4-limit").val());if(w){l={type:"MaxEquipLimit"};l.value=w,l.condition="Global",l.cal="Abs",l.rarity=4,t.push(l)}var T=Number($("#input-cal-ultimate-5-limit").val());if(T){l={type:"MaxEquipLimit"};l.value=T,
l.condition="Global",l.cal="Abs",l.rarity=5,t.push(l)}var x=Number($("#input-cal-ultimate-2-price").val());if(x){l={type:"UseAll"};l.value=x,l.condition="Global",l.cal="Percent",l.rarity=2,t.push(l)}var D=Number($("#input-cal-ultimate-3-price").val());if(D){l={type:"UseAll"};l.value=D,l.condition="Global",l.cal="Percent",l.rarity=3,t.push(l)}var q=Number($("#input-cal-ultimate-4-price").val());if(q){l={type:"UseAll"};l.value=q,l.condition="Global",l.cal="Percent",l.rarity=4,t.push(l)}var S=Number($("#input-cal-ultimate-5-price").val());if(S){l={type:"UseAll"};l.value=S,l.condition="Global",l.cal="Percent",l.rarity=5,t.push(l)}var C=$("#chk-cal-partial-ultimate").val();for(var E in C)C[E]=Number(C[E]);var I=getPartialUltimateData(a.chefs,a.partialSkill,!0,C),M=$("#chk-cal-self-ultimate").val();for(var E in M)M[E]=Number(M[E]);var N=getSelfUltimateData(a.chefs,a.skills,!0,M);e.calGlobalUltimateData=t,e.calPartialChefIds=C,e.calSelfUltimateData=N;var R=$("#chk-cal-ex").val();for(var E in R)R[E]=Number(R[E]);for(var E in e.menus){var _=R.indexOf(e.menus[E].recipe.data.recipeId)>=0;setDataForRecipe(e.menus[E].recipe.data,t,_,!1);var A=getRecipeQuantity(e.menus[E].recipe.data,e.materials,e),G=getRecipeResult(null,null,e.menus[E].recipe.data,A,A,e.materials,e,e.decorationEffect);G.available=A,G.availableScore=G.totalScore/G.max*A,e.menus[E].recipe=G}for(var E in e.chefs)setDataForChef(e.chefs[E],null,!1,t,I,null,N,!1)}function loadRule(e,a){a.DisableDecorationEffect?($("#input-cal-decoration").prop("disabled",!0),$("#btn-cal-decoration").prop("disabled",!0)):($("#input-cal-decoration").prop("disabled",!1),$("#btn-cal-decoration").prop("disabled",!1));var t=JSON.parse(JSON.stringify(e.recipes)),i=JSON.parse(JSON.stringify(e.chefs)),l=JSON.parse(JSON.stringify(e.equips)),s=JSON.parse(JSON.stringify(e.materials));for(var r in a.MaterialsEffect)for(var c in s)if(s[c].materialId==a.MaterialsEffect[r].MaterialID){s[c].addition=+(Number(s[c].addition)+a.MaterialsEffect[r].Effect).toFixed(2);break}var n=[];if(a.hasOwnProperty("MaterialsNum")){for(var r in a.MaterialsNum)for(var c in s)if(s[c].materialId==a.MaterialsNum[r].MaterialID){1!=a.MaterialsNum[r].Num&&(s[c].quantity=a.MaterialsNum[r].Num),n.push(s[c]);break}}else for(var r in s)n.push(s[r]);var o=[];for(var r in t)if(!(t[r].hide||a.hasOwnProperty("CookbookRarityLimit")&&t[r].rarity>a.CookbookRarityLimit)){var p=getRecipeQuantity(t[r],n,a);if(0!=p){if(a.hasOwnProperty("RecipesTagsEffect"))for(var c in t[r].tags)for(var d in a.RecipesTagsEffect)t[r].tags[c]==a.RecipesTagsEffect[d].TagID&&(t[r].addition=+(Number(t[r].addition)+a.RecipesTagsEffect[d].Effect).toFixed(2));for(var d in a.RecipesEffect)t[r].recipeId==a.RecipesEffect[d].RecipeID&&(t[r].addition=+(Number(t[r].addition)+a.RecipesEffect[d].Effect).toFixed(2));for(var d in a.RecipesSkillsEffect)("stirfry"==a.RecipesSkillsEffect[d].Skill&&t[r].stirfry>0||"boil"==a.RecipesSkillsEffect[d].Skill&&t[r].boil>0||"knife"==a.RecipesSkillsEffect[d].Skill&&t[r].knife>0||"fry"==a.RecipesSkillsEffect[d].Skill&&t[r].fry>0||"bake"==a.RecipesSkillsEffect[d].Skill&&t[r].bake>0||"steam"==a.RecipesSkillsEffect[d].Skill&&t[r].steam>0)&&(t[r].addition=+(Number(t[r].addition)+a.RecipesSkillsEffect[d].Effect).toFixed(2));o.push(t[r])}}var u=[];for(var r in i)if(!(i[r].hide||a.hasOwnProperty("ChefRarityLimit")&&i[r].rarity>a.ChefRarityLimit)){var f=!1;if(a.hasOwnProperty("EnableChefTags")){for(var c in a.EnableChefTags)if(i[r].tags.indexOf(a.EnableChefTags[c])>=0){f=!0;break}}else f=!0;if(f){if(a.hasOwnProperty("ChefsTagsEffect"))for(var c in i[r].tags)for(var d in a.ChefsTagsEffect)i[r].tags[c]==a.ChefsTagsEffect[d].TagID&&(i[r].addition=+(Number(i[r].addition)+a.ChefsTagsEffect[d].Effect).toFixed(2));u.push(i[r])}}var h=[];for(var r in l)l[r].hide||h.push(l[r]);a.recipes=o,a.chefs=u,a.equips=h,a.materials=n,a.rest=n;var m=[];for(var c in a.recipes){p=getRecipeQuantity(a.recipes[c],a.materials,a);var b=getRecipeResult(null,null,a.recipes[c],p,p,a.materials,a,a.decorationEffect);b.available=p,b.availableScore=b.totalScore/b.max*p;var v={};v.recipe=b,m.push(v)}a.menus=m;var g=[];for(r=0;r<9;r++){var k={};k.group=Math.floor(r/3),k.chef={},k.recipe={},k.recipe.data={},k.equip={},g.push(k)}a.hasOwnProperty("MaterialsEffect")||a.hasOwnProperty("ChefsTagsEffect")||a.hasOwnProperty("RecipesTagsEffect")||a.hasOwnProperty("RecipesSkillsEffect")||a.hasOwnProperty("RecipesEffect")?a.hasRuleAddition=!0:a.hasRuleAddition=!1,"正常营业"==a.Title?(a.showTime=!0,a.showEff=!0,$('#select-cal-order option[value="分数"]').siblings().removeAttr("disabled")):(a.showTime=!1,a.showEff=!1,$("#select-cal-order").val("分数"),$('#select-cal-order option[value="分数"]').siblings().attr("disabled","disabled")),sortRecipesResult(),a.showTime?$(".chk-cal-results-show-total-time").prop("checked",!0):$(".chk-cal-results-show-total-time").prop("checked",!1),a.showEff?$(".chk-cal-results-show-efficiency").prop("checked",!0):$(".chk-cal-results-show-efficiency").prop("checked",!1),$("#cal-recipes-results-table").DataTable().clear().rows.add(m).draw(),initCalResultsShow("recipes",$("#cal-recipes-results-table").DataTable(),$("#pane-cal-recipes-results")),$("#cal-self-select-table").DataTable().clear().rows.add(g),initCalResultsShow("self-select",$("#cal-self-select-table").DataTable(),$("#pane-cal-self-select")),$("#pane-cal-self-select .selected-sum").html("请选择"),$("#pane-cal-self-select .selected-sum-2").html(""),private&&($("#cal-chefs-table").DataTable().clear().rows.add(u).draw(),$("#btn-cal-chefs-select-all").click(),$("#cal-materials-table").DataTable().clear().rows.add(n).draw(),$("#btn-cal-materials-select-all").click(),$("#cal-equips-table").DataTable().clear().rows.add(h).draw(),$("#btn-cal-equips-select-all").click())}function initCalCustomOptions(e,a){var t=getChefsOptions(e.chefs),i=getRecipesOptions(e),l=getEquipsOptions(e.equips,a.skills);$("#cal-self-select-table").DataTable().MakeCellsEditable("destroy"),$("#cal-self-select-table").DataTable().MakeCellsEditable({columns:[2,3,5,15],inputTypes:[{column:2,type:"list",search:!0,clear:!0,options:t},{column:3,type:"list",search:!0,clear:!0,options:l},{column:5,type:"list",search:!0,clear:!0,options:i,optionsp:!0}],onUpdate:function(t,i,l,s){var r=i.data().group;if($(l.node()).hasClass("cal-td-chef-name")){var c=l.data(),n="";if($("#chk-cal-use-equip").prop("checked")&&c)for(var o in e.chefs)if(e.chefs[o].name==c){n=e.chefs[o].equipName;break}for(var p=0;p<3;p++)t.data()[3*r+p].chef.name=c,$("#chk-cal-use-equip").prop("checked")&&(t.data()[3*r+p].equip.name=n)}else if($(l.node()).hasClass("cal-td-equip-name"))for(p=0;p<3;p++)t.data()[3*r+p].equip.name=l.data();else $(l.node()).hasClass("cal-td-recipe-name")&&l.data()!=s&&(i.data().recipe.quantity=0,i.data().recipe.setQuantity=!0);calCustomResults(e,a),$(t.body()).removeClass("processing")},waitUpdate:!0})}function calCustomResults(e,a){var t=$("#cal-self-select-table").DataTable(),i=t.data().toArray(),l=[];for(var s in i){var r={},c=i[s].chef.name||"";if(c)for(var n in r.name=c,e.chefs)if(e.chefs[n].name==c){r=JSON.parse(JSON.stringify(e.chefs[n]));break}var o=getEquipInfo(i[s].equip.name,e.equips);i[s].equip=o||{},r.chefId&&l.indexOf(r.chefId)<0&&e.calPartialChefIds.indexOf(r.chefId)>=0&&l.push(r.chefId),i[s].chef=r;var p={data:{}},d=i[s].recipe.data.name?i[s].recipe.data.name:"";if(d)for(var n in p.data.name=d,p.disp=d,e.menus)if(e.menus[n].recipe.data.name==d){p.data=JSON.parse(JSON.stringify(e.menus[n].recipe.data));var u=i[s].recipe.quantity;u||(u=0);var f=e.menus[n].recipe.max;u>f&&(u=f),p.quantity=u,p.max=f,p.setQuantity=i[s].recipe.setQuantity;break}i[s].recipe=p}var h=checkMaterials2(i,e.materials);for(var s in i)if(i[s].recipe.data.recipeId&&i[s].recipe.setQuantity){var m=getRecipeQuantity(i[s].recipe.data,h.materials,e),b=i[s].recipe.max-i[s].recipe.quantity;m>b&&(m=b),i[s].recipe.quantity=m,i[s].recipe.setQuantity=!1}var v=getPartialUltimateData(a.chefs,a.partialSkill,!0,l),g=0,k=0,y=0,w=0,T=0,x="",D="",q="",S="",C="";for(var s in i){if(i[s].chef.chefId&&(setDataForChef(i[s].chef,i[s].equip,!0,e.calGlobalUltimateData,v,v,e.calSelfUltimateData,!1),s%3==0&&(e&&e.hasOwnProperty("DisableChefSkillEffect")&&0!=e.DisableChefSkillEffect||(T+=getTimeAddition(i[s].chef.specialSkillEffect)),(!e||!e.hasOwnProperty("DisableEquipSkillEffect")||0==e.DisableEquipSkillEffect)&&i[s].equip&&i[s].equip.effect))){var E=updateEquipmentEffect(i[s].equip.effect,i[s].chef.selfUltimateEffect);T+=getTimeAddition(E)}if(i[s].recipe.data.recipeId&&(i[s].recipe.totalTime=i[s].recipe.data.time*i[s].recipe.quantity,i[s].recipe.totalTimeDisp=secondsToTime(i[s].recipe.totalTime),w+=i[s].recipe.totalTime),i[s].recipe.data.recipeId&&i[s].chef.chefId){var I=getRecipeResult(i[s].chef,i[s].equip,i[s].recipe.data,i[s].recipe.quantity,i[s].recipe.max,e.materials,e,e.decorationEffect);if(I.rankVal>0)i[s].recipe=I,g+=I.totalPrice,k+=I.totalBonusScore,y+=I.totalScore,I.data.ultimateAdditionDisp&&I.quantity>0&&(1==I.data.rarity?x=I.data.ultimateAdditionDisp:2==I.data.rarity?D=I.data.ultimateAdditionDisp:3==I.data.rarity?q=I.data.ultimateAdditionDisp:4==I.data.rarity?S=I.data.ultimateAdditionDisp:5==I.data.rarity&&(C=I.data.ultimateAdditionDisp));else{var M=getSkillDiff(i[s].chef,i[s].recipe.data,1);i[s].recipe.disp+="<br><small>"+M.disp+"</small>"}}}for(var s in h=checkMaterials2(i,e.materials),i)if(i[s].recipe.data.recipeId){m=getRecipeQuantity(i[s].recipe.data,h.materials,e),b=i[s].recipe.max-i[s].recipe.quantity;m>b&&(m=b),i[s].recipe.available=m}if(t.clear().rows.add(i).draw(),$("#pane-cal-self-select .selected-sum").html("").append("原售价："+g),e.hasRuleAddition&&$("#pane-cal-self-select .selected-sum").append(" 规则分："+k),$("#pane-cal-self-select .selected-sum").append(" 总得分："+y),e.showTime){for(var s in v)T+=getTimeAddition(v[s].effect);0!=+T.toFixed(2)&&$("#pane-cal-self-select .selected-sum").append(" 原时间："+(secondsToTime(w)||0));var N=Math.ceil(+(w*(1+T/100)).toFixed(2));$("#pane-cal-self-select .selected-sum").append(" 总时间："+(secondsToTime(N)||0));var R=0;N>0&&(R=Math.floor(3600*y/N)),$("#pane-cal-self-select .selected-sum").append(" 总效率："+R+"金币/小时")}h.message&&$("#pane-cal-self-select .selected-sum").append(" ("+h.message+")"),$("#pane-cal-self-select .selected-sum-2").html("当前菜谱使用菜谱售价修炼加成："),x||D||q||S||C?(x&&$("#pane-cal-self-select .selected-sum-2").append("1星"+x+" "),D&&$("#pane-cal-self-select .selected-sum-2").append("2星"+D+" "),q&&$("#pane-cal-self-select .selected-sum-2").append("3星"+q+" "),S&&$("#pane-cal-self-select .selected-sum-2").append("4星"+S+" "),C&&$("#pane-cal-self-select .selected-sum-2").append("5星"+C+" ")):$("#pane-cal-self-select .selected-sum-2").append("无"),e.rest=h.materials,calRecipesResults(e),initCalCustomOptions(e,a)}function getRecipesOptions(e){var a={},t=$("#cal-self-select-table").DataTable().data().toArray(),i=$("#select-cal-order").val(),l=$("#chk-cal-got").prop("checked"),s=$("#chk-cal-no-origin").prop("checked");for(var r in t)if(r%3!=0)a[r]=a[r-1];else{var c=[];for(var n in e.menus)if((!l||e.menus[n].recipe.data.got)&&(s||e.menus[n].recipe.data.origin)){var o={};o.display=e.menus[n].recipe.data.name,o.value=e.menus[n].recipe.data.name;var p=e.menus[n].recipe.totalScore,d=e.menus[n].recipe.efficiency,u="";if(t[r].chef.chefId){var f=getRecipeResult(t[r].chef,t[r].equip,e.menus[n].recipe.data,e.menus[n].recipe.max,e.menus[n].recipe.max,e.materials,e,e.decorationEffect);if(f.rankVal>0)p=f.totalScore,d=f.efficiency;else{var h=getSkillDiff(t[r].chef,e.menus[n].recipe.data,1);u=" "+h.disp}}var m=!1;if(e.hasOwnProperty("MaterialsNum")){var b=p/e.menus[n].recipe.max*e.menus[n].recipe.available;o.subtext=e.menus[n].recipe.available+"/"+e.menus[n].recipe.max+" "+b+"/"+p,o.order=b,e.menus[n].recipe.available<e.menus[n].recipe.max&&(m=!0)}else"分数"==i?(o.subtext=p,o.order=p):"时间"==i?(o.subtext=e.menus[n].recipe.data.totalTimeDisp,o.order=e.menus[n].recipe.data.totalTime):"效率"==i&&(o.subtext=d,o.order=d);o.class="",""!=u&&(o.subtext+=" "+u,o.class+="option-warning"),m&&(o.class+=" option-sub-warning"),c.push(o)}c.sort(function(e,a){return a.order-e.order});o={display:"无菜谱",value:"",class:"hidden"};c.unshift(o),a[r]=c}return a}function calRecipesResults(e){var a=$("#cal-recipes-results-table").DataTable(),t=a.rows({order:"applied"}).data().toArray(),i=a.rows({selected:!0}).data().toArray(),l=$("#cal-self-select-table").DataTable().data().toArray();for(var s in t){var r=getRecipeQuantity(t[s].recipe.data,e.rest,e);for(var c in l)if(t[s].recipe.data.recipeId==l[c].recipe.data.recipeId){var n=t[s].recipe.max-l[c].recipe.quantity;r>n&&(r=n)}t[s].recipe.available=r,t[s].recipe.availableScore=t[s].recipe.totalScore/t[s].recipe.max*r}a.clear().rows.add(t),$("#pane-cal-recipes-results .chk-cal-results-lock-order").prop("checked")&&a.order([]),a.rows(function(e,a,t){for(var l in i)if(a.recipe.data.recipeId==i[l].recipe.data.recipeId)return!0;return!1}).select(),a.draw()}function sortRecipesResult(){var e=30,a=$("#select-cal-order").val();"分数"==a?e=30:"时间"==a?e=31:"效率"==a&&(e=32);var t=!1,i=$("#cal-recipes-results-table").DataTable(),l=i.order();for(var s in l)if(l[s][0]==e&&"desc"==l[s][1]){t=!0;break}t||i.order([e,"desc"]).draw()}function checkMaterials2(e,a){var t=JSON.parse(JSON.stringify(a));for(var i in e){var l=e[i].recipe;if(l.data.recipeId)for(var s in l.data.materials)for(var r in t)l.data.materials[s].material==t[r].materialId&&Number.isInteger(parseInt(t[r].quantity))&&(t[r].quantity-=l.data.materials[s].quantity*l.quantity)}var c="";for(var r in t)t[r].quantity<0&&(c+=t[r].name+t[r].quantity);return{materials:t,message:c}}function initCalChefsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"galleryId",width:"1px"},{data:"name",width:"81px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"50px",orderSequence:["desc","asc"]},{data:{_:"stirfryVal",display:"stirfryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"boilVal",display:"boilDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"knifeVal",display:"knifeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"fryVal",display:"fryDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"bakeVal",display:"bakeDisp"},width:"20px",orderSequence:["desc","asc"]},{data:{_:"steamVal",display:"steamDisp"},width:"20px",orderSequence:["desc","asc"]},{data:"specialSkillDisp"},{data:"gender",width:"30px"},{data:"origin"},{data:"tagsDisp",defaultContent:""},{data:"addition",className:"cal-td-input-addition nodetails all",orderSequence:["desc","asc"],width:"38px"},{data:"equipName",className:"cal-td-select-equip nodetails all",width:"101px"}],t=$("#cal-chefs-table").DataTable({data:[],columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨师",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨师",0:"选择了 %d 个厨师",1:"选择了 %d 个厨师"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)if(t[l].hidden){if(l>4&&l<=9)continue;if(4==l){i+="<div class='col-lg-3 col-sm-6 col-xs-12'>";for(var s=4;s<=9;s++)t[s].data&&(i+="<span class='child-key'>"+t[s].title+"</span><span class='child-value'>"+t[s].data+"</span>");i+="</div>"}else i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(1==l?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>"}return!!i&&"<div class='child-inner'>"+i+"</div>"}}}});$("#pane-cal-chefs div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="名字 性别"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-chefs-table"))return!0;var s=$.trim($("#pane-cal-chefs .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.gender,s)||!!commaSeparatedMatch(i.tagsDisp,s))});var i=getEquipsOptions(e.equips,e.skills);t.MakeCellsEditable({columns:[14,15],inputTypes:[{column:15,type:"list",search:!0,clear:!0,options:i}]}),$("#chk-cal-chefs-show").on("changed.bs.select",function(){initCalChefsShow(t)}),$('.chk-cal-chefs-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#btn-cal-chefs-equip-clear").click(function(){t.rows().every(function(e,a,t){this.cell(e,".cal-td-select-equip").data("")})}),$("#pane-cal-chefs .search-box input").keyup(function(){t.draw(),changeInputStyle(this)}),$("#btn-cal-chefs-select-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-chefs-deselect-all").click(function(){$('.chk-cal-chefs-rarity input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalChefsShow(t)}function initCalEquipsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"galleryId",width:"1px"},{data:"name",width:"80px",className:"all"},{data:{_:"rarity",display:"rarityDisp"},className:"rarity",width:"35px",orderSequence:["desc","asc"]},{data:"skillDisp"},{data:"origin"}],t=$("#cal-equips-table").DataTable({data:[],columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个厨具",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个厨具",0:"选择了 %d 个厨具",1:"选择了 %d 个厨具"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[4,"desc"]],autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("rarity-"+a.rarity)},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)t[l].hidden&&(i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(1==l?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>");return!!i&&"<div class='child-inner'>"+i+"</div>"}}}});$("#pane-cal-equips div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="名字 技能 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-equips-table"))return!0;var s=$.trim($("#pane-cal-equips .search-box input").val());return!!commaSeparatedMatch(i.name,s)||(!!commaSeparatedMatch(i.skillDisp,s)||!!commaSeparatedMatch(i.origin,s))}),$("#chk-cal-equips-show").on("changed.bs.select",function(){initCalEquipsShow(t)}),$('.chk-cal-equips-rarity input[type="checkbox"]').click(function(){var e=$(this).attr("data-rarity");$(this).prop("checked")?t.rows(".rarity-"+e).select():t.rows(".rarity-"+e).deselect()}),$("#pane-cal-equips .search-box input").keyup(function(){t.draw(),changeInputStyle(this)}),$("#btn-cal-equips-select-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-equips-deselect-all").click(function(){$('.chk-cal-equips-origin input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),$("#btn-cal-equips-export").click(function(){var e=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),a={calEquips:[]};for(var t in e)a.calEquips.push(e[t].equipId);$("#input-export-import").val(JSON.stringify(a))}),initCalEquipsShow(t)}function initCalMaterialsTable(e){var a=[{data:void 0,defaultContent:"",className:"select-checkbox nodetails all",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"materialId",width:"1px"},{data:"name",className:"all"},{data:"origin"},{data:"quantity",className:"cal-td-input-quantity nodetails all",orderSequence:["desc","asc"],width:"50px"},{data:"addition",className:"cal-td-input-addition nodetails all",orderSequence:["desc","asc"],width:"50px"}],t=$("#cal-materials-table").DataTable({data:[],columns:a,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 个",zeroRecords:"没有找到",info:"共 _MAX_ 个食材",infoEmpty:"没有数据",infoFiltered:"",select:{rows:{_:"选择了 %d 个食材",0:"选择了 %d 个食材",1:"选择了 %d 个食材"}}},pagingType:"numbers",lengthMenu:[[10,20,50,100,-1],[10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},order:[[3,"desc"]],autoWidth:!1,createdRow:function(e,a,t){$(e).addClass("origin-"+a.originVal)},responsive:{details:{type:"column",target:"td:not(.nodetails)",renderer:function(e,a,t){var i="";for(var l in t)t[l].hidden&&(i+="<div class='col-lg-3 col-sm-6 col-xs-12'><span class='child-key'>"+t[l].title+(1==l?"":"：")+"</span><span class='child-value'>"+t[l].data+"</span></div>");return!!i&&"<div class='child-inner'>"+i+"</div>"}}}});$("#pane-cal-materials div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="名字 来源"></label>'),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-materials-table"))return!0;var s=$.trim($("#pane-cal-materials .search-box input").val());return!!commaSeparatedMatch(i.name,s)||!!commaSeparatedMatch(i.origin,s)}),t.MakeCellsEditable({columns:[4,5]}),$("#chk-cal-materials-show").on("changed.bs.select",function(){initCalMaterialsShow(t)}),$('.chk-cal-materials-origin input[type="checkbox"]').click(function(){var e=$(this).attr("data-origin");$(this).prop("checked")?t.rows(".origin-"+e).select():t.rows(".origin-"+e).deselect()}),$("#pane-cal-materials .search-box input").keyup(function(){t.draw(),changeInputStyle(this)}),$("#btn-cal-materials-select-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!0),t.rows().select()}),$("#btn-cal-materials-deselect-all").click(function(){$('.chk-cal-materials-origin input[type="checkbox"]').prop("checked",!1),t.rows().deselect()}),initCalMaterialsShow(t)}function initCalResultsTable(e){var a;($("#pane-cal-self-select").html($("#pane-cal-results-common").html()),$("#pane-cal-self-select .cal-results-table").prop("id","cal-self-select-table"),initCalResultTableCommon("self-select",$("#pane-cal-self-select")),$("#pane-cal-recipes-results").html($("#pane-cal-results-common").html()),$("#pane-cal-recipes-results .cal-results-table").prop("id","cal-recipes-results-table"),initCalResultTableCommon("recipes",$("#pane-cal-recipes-results")),private)&&($("#cal-optimal-results-place").html($("#pane-cal-results-common").html()),$("#cal-optimal-results-place .cal-results-table").prop("id","cal-optimal-results-table"),initCalResultTableCommon("optimal",$("#pane-cal-optimal-results")),$(".btn-cal-results-cal").click(function(){if(currentRule){var t=$("#pane-cal-optimal-results");if(void 0!==a&&(a.terminate(),a=void 0),$(this).hasClass("stop"))return t.find(".cal-results-progress").addClass("hidden"),t.find(".btn-cal-results-cal.start").prop("disabled",!1),void t.find(".btn-cal-results-cal.stop").prop("disabled",!0);t.find(".btn-cal-results-cal.start").prop("disabled",!0),t.find(".btn-cal-results-cal.stop").prop("disabled",!1),t.find(".cal-results-wrapper").addClass("hidden"),t.find(".cal-results-progress .progress-bar").css("width","0%"),t.find(".cal-results-progress .progress-bar span").text("预处理中"),t.find(".cal-results-progress").removeClass("hidden"),a=new Worker("others/js/cal.js?v="+(new Date).getTime()),a.onmessage=function(e){e.data.progress?(t.find(".cal-results-progress .progress-bar").css("width",e.data.progress.value+"%"),t.find(".cal-results-progress .progress-bar span").text(e.data.progress.display)):e.data.menu?(e.data.message?t.find(".selected-sum").html(e.data.message):t.find(".selected-sum").html(""),console.log(e.data.menu),$("#cal-optimal-results-table").DataTable().clear().rows.add(e.data.menu).draw(),t.find(".cal-results-wrapper").removeClass("hidden")):e.data.done?(t.find(".btn-cal-results-cal.stop").prop("disabled",!0),t.find(".btn-cal-results-cal.start").prop("disabled",!1),t.find(".cal-results-progress").addClass("hidden")):e.data.error&&alert(e.data.error)};var i=$("#cal-self-select-table").DataTable().data().toArray(),l=$("#cal-recipes-results-table").DataTable().rows({selected:!0}).data().toArray(),s=$("#cal-chefs-table").DataTable().rows({selected:!0}).data().toArray(),r=$("#cal-equips-table").DataTable().rows({selected:!0}).data().toArray(),c=$("#cal-materials-table").DataTable().rows({selected:!0}).data().toArray(),n=$("#chk-cal-results-no-equips").prop("checked"),o=$("#chk-cal-results-add-equips").prop("checked"),p=$("#chk-cal-results-change-equips").prop("checked"),d=$("#chk-cal-results-fix-equips").prop("checked"),u=Number($("#input-cal-min-score").val()),f=Number($("#input-cal-thread").val()),h=$("#select-cal-type").val();a.postMessage({mode:h,rule:currentRule,custom:i,recipes:l,chefs:s,equips:r,materials:c,odata:e,noEquips:n,addEquips:o,changeEquips:p,fixEquips:d,minScore:u,thread:f})}else alert("请加载规则")}),$("#btn-cal-set-custom").click(function(){if(currentRule){var a=JSON.parse(JSON.stringify($("#cal-optimal-results-table").DataTable().data()));9==a.length&&($("#cal-self-select-table").DataTable().clear().rows.add(a),calCustomResults(currentRule,e))}else alert("请加载规则")}));$("#pane-cal-results-common").remove()}function initCalResultTableCommon(e,a){var t=[{data:void 0,defaultContent:"",className:"select-checkbox",orderDataType:"dom-selected",orderSequence:["desc","asc"],width:"30px"},{data:"group",defaultContent:""},{data:{_:"chef.name",display:"chef.disp"},className:"cal-td-chef-name",defaultContent:""},{data:{_:"equip.name",display:"equip.disp"},className:"cal-td-equip-name",defaultContent:""},{data:"recipe.data.galleryId",defaultContent:"",width:"1px"},{data:{_:"recipe.data.name",display:"recipe.disp"},className:"cal-td-recipe-name",defaultContent:"",width:"86px"},{data:{_:"recipe.data.rarity",display:"recipe.data.rarityDisp"},defaultContent:"",orderSequence:["desc","asc"],className:"rarity",width:"50px"},{data:"recipe.data.stirfry",defaultContent:"",orderSequence:["desc","asc"],width:"20px"},{data:"recipe.data.boil",defaultContent:"",orderSequence:["desc","asc"],width:"20px"},{data:"recipe.data.knife",defaultContent:"",orderSequence:["desc","asc"],width:"20px"},{data:"recipe.data.fry",defaultContent:"",orderSequence:["desc","asc"],width:"20px"},{data:"recipe.data.bake",defaultContent:"",orderSequence:["desc","asc"],width:"20px"},{data:"recipe.data.steam",defaultContent:"",orderSequence:["desc","asc"],width:"20px"},{data:{_:"recipe.data.materialsVal",display:"recipe.data.materialsDisp"},defaultContent:"",width:"230px"},{data:"recipe.data.origin",defaultContent:"",width:"115px"},{data:"recipe.quantity",className:"cal-td-quantity",defaultContent:"",orderSequence:["desc","asc"],width:"30px"},{data:"recipe.available",defaultContent:"",orderSequence:["desc","asc"],width:"30px"},{data:"recipe.availableScore",defaultContent:"",orderSequence:["desc","asc"],width:"80px"},{data:"recipe.max",defaultContent:"",orderSequence:["desc","asc"],width:"30px"},{data:{_:"recipe.data.price",display:"recipe.data.priceDisp"},defaultContent:"",orderSequence:["desc","asc"],width:"32px"},{data:{_:"recipe.rankVal",display:"recipe.rankDisp"},defaultContent:"",orderSequence:["desc","asc"],width:"30px"},{data:"recipe.rankAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.chefSkillAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.equipSkillAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.bonusAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.data.ultimateAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.decorationAdditionDisp",defaultContent:"",orderSequence:["desc","asc"],width:"60px"},{data:"recipe.totalPrice",defaultContent:"",orderSequence:["desc","asc"]},{data:"recipe.totalRealPrice",defaultContent:"",orderSequence:["desc","asc"]},{data:"recipe.totalBonusScore",defaultContent:"",orderSequence:["desc","asc"]},{data:"recipe.totalScore",defaultContent:"",orderSequence:["desc","asc"]},{data:{_:"recipe.totalTime",display:"recipe.totalTimeDisp"},defaultContent:""},{data:"recipe.efficiency",defaultContent:"",orderSequence:["desc","asc"]}],i=!0,l=!0,s=!0;"optimal"!=e&&"self-select"!=e||(i=!1,l=!1,s=!1);var r=a.find(".cal-results-table").DataTable({data:[],columns:t,language:{search:"查找:",lengthMenu:"一页显示 _MENU_ 条",zeroRecords:"没有找到",info:"共 _TOTAL_ 条",infoEmpty:"没有数据",infoFiltered:"(从 _MAX_ 条中过滤)",select:{rows:{_:"选择了 %d 个菜谱",0:"选择了 %d 个菜谱",1:"选择了 %d 个菜谱"}}},paging:i,pagingType:"numbers",lengthMenu:[[5,10,20,50,100,-1],[5,10,20,50,100,"所有"]],pageLength:20,dom:"<'row'<'col-sm-12'<'selected-sum'>>><'row'<'col-sm-12'<'selected-sum-2'>>><'row'<'col-sm-4'l><'col-sm-4 text-center'i><'col-sm-4'<'search-box'>>><'row'<'col-sm-12'tr>><'row'<'col-sm-12'p>>",select:{style:"multi",selector:"td.select-checkbox"},autoWidth:!1,info:l,ordering:s,order:[],rowsGroup:[1,2,3]});return"recipes"==e&&(a.find("div.search-box").html('<label>查找:<input type="search" class="form-control input-sm monitor-none" placeholder="菜名 材料"></label>'),a.find(".search-box input").keyup(function(){r.draw(),changeInputStyle(this)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;var s=$.trim($("#pane-cal-recipes-results .search-box input").val());return!!commaSeparatedMatch(i.recipe.data.name,s)||(!!commaSeparatedMatch(i.recipe.data.materialsVal,s)||!!commaSeparatedMatch(i.recipe.data.tagsDisp,s))}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;var s=$("#chk-cal-got").prop("checked");return!!(!s||s&&i.recipe.data.got)}),$.fn.dataTableExt.afnFiltering.push(function(e,a,t,i,l){if(e.nTable!=document.getElementById("cal-recipes-results-table"))return!0;var s=$("#chk-cal-no-origin").prop("checked");return!!(s||!s&&i.recipe.data.origin)}),a.find(".btn-cal-recipes-select-all").off("click").click(function(){r.rows().select()}),a.find(".btn-cal-recipes-deselect-all").off("click").click(function(){r.rows().deselect()})),a.find(".chk-cal-results-show").off("click").click(function(){initCalResultsShow(e,r,a)}),initCalResultsShow(e,r,a),r}function generateData(e,a,t){var i={};if(a){for(var l in a.equips)a.equips[l].hide=!0;for(var l in a.decorations)a.decorations[l].hide=!0;for(var l in a.recipes)a.recipes[l].hide=!0;for(var l in a.chefs)a.chefs[l].hide=!0;e.guests=e.guests.concat(a.guests),e.equips=e.equips.concat(a.equips),e.decorations=e.decorations.concat(a.decorations),e.quests=e.quests.concat(a.quests),e.recipes=e.recipes.concat(a.recipes),e.chefs=e.chefs.concat(a.chefs),e.skills=e.skills.concat(a.skills),e.rules=e.rules.concat(a.rules),e.activities=e.activities.concat(a.activities),i.ranks=a.ranks}i.maps=e.maps,i.activities=e.activities,i.guests=e.guests,i.history=e.history,i.skills=e.skills;var s=[];for(var l in e.skills){var r=!1;for(var c in e.skills[l].effect)if("Partial"==e.skills[l].effect[c].condition){r=!0;break}r&&s.push(e.skills[l])}i.partialSkill=s,i.rules=e.rules,i.decorationEffect=0,t&&t.decorationEffect&&(i.decorationEffect=t.decorationEffect),e.materials.sort(function(e,a){return e.origin.localeCompare(a.origin)});var n=[]
;for(var l in e.materials){var o=e.materials[l];o.originVal=getOriginVal(e.materials[l].origin),o.addition="",o.quantity="",n.push(o)}i.materials=n;var p=[];for(var l in e.equips)if(e.equips[l].name){var d=e.equips[l];d.rarityDisp=getRarityDisp(e.equips[l].rarity);var u=getSkillInfo(e.skills,e.equips[l].skill);d.skillDisp=u.skillDisp,d.skillSort=0,d.effect=u.skillEffect,e.equips[l].hide?d.icon="<div class='icon-equip2 equip_"+e.equips[l].equipId+"'></div>":d.icon="<div class='icon-equip equip_"+e.equips[l].equipId+"'></div>",p.push(d)}i.equips=p;var f=[],h=[];for(var l in e.decorations){var m=e.decorations[l];if(m.tipMin=m.tipMin||"-",m.tipMax=m.tipMax||"-",m.tipTimeDisp=secondsToTime(m.tipTime)||"-",m.tipTime&&(m.minEff=+(3600*m.tipMin*24/m.tipTime).toFixed(1),m.maxEff=+(3600*m.tipMax*24/m.tipTime).toFixed(1),m.avgEff=+((m.tipMin+m.tipMax)/2*3600*24/m.tipTime).toFixed(1)),m.goldDisp=getPercentDisp(+(100*m.gold).toFixed(2))||"-",m.suitDisp=m.suit||"-",m.suitGoldDisp=getPercentDisp(+(100*m.suitGold).toFixed(2))||"-",e.decorations[l].hide?m.icon="<div class='icon-decoration2 decoration_"+m.icon+"'></div>":m.icon="<div class='icon-decoration decoration_"+m.icon+"'></div>",h.push(m),m.suit){var b=!1;for(var c in f)if(f[c].name==m.suit){f[c].decorations.push(m.id),b=!0;break}if(!b){var v={};v.name=m.suit,v.gold=m.suitGold,v.decorations=[],v.decorations.push(m.id),f.push(v)}}}i.decorations=h,i.suits=f;var g=[];for(var l in e.quests)if(e.quests[l].goal){var k=e.quests[l];k.questIdDisp=e.quests[l].questIdDisp?e.quests[l].questIdDisp:e.quests[l].questId;var y="",w="";for(var c in e.quests[l].rewards)y+=e.quests[l].rewards[c].name,e.quests[l].rewards[c].quantity&&(y+="*"+e.quests[l].rewards[c].quantity),y+=" ",w+=e.quests[l].rewards[c].name;k.rewardsVal=w,k.rewardsDisp=y,g.push(k)}i.quests=g;var T=$("#chk-setting-show-final").prop("checked"),x=$("#chk-chef-apply-equips").prop("checked"),D=$("#chk-chef-apply-ultimate").prop("checked"),q=$("#chk-chef-apply-ultimate-person").prop("checked"),S=getUltimateData(e.chefs,t,e.skills,D,q);i.ultimateData=S;var C=[];for(var l in e.chefs)if(e.chefs[l].name){var E=e.chefs[l];E.addition="",E.rarityDisp=getRarityDisp(e.chefs[l].rarity),e.chefs[l].hide?E.icon="<div class='icon-chef2 chef_"+e.chefs[l].chefId+"'></div>":E.icon="<div class='icon-chef chef_"+e.chefs[l].chefId+"'></div>";u=getSkillInfo(e.skills,e.chefs[l].skill);if(E.specialSkillDisp=u.skillDisp,E.specialSkillEffect=u.skillEffect,E.tags=e.chefs[l].tags||[],E.tagsDisp="",a)for(var c in a.chefsTags)if(a.chefsTags[c].chefId==e.chefs[l].chefId){E.tags=a.chefsTags[c].tags,E.tagsDisp=getTagsDisp(a.chefsTags[c].tags,a.tags);break}E.gender=getGender(E.tags);var I="";for(var c in e.chefs[l].ultimateGoal)for(var M in e.quests)if(e.chefs[l].ultimateGoal[c]==e.quests[M].questId){I+=e.quests[M].goal+"<br>";break}E.ultimateGoalDisp=I;var N=getSkillInfo(e.skills,e.chefs[l].ultimateSkill);if(E.ultimateSkillDisp=N.skillDisp,E.ultimateSkillEffect=N.skillEffect,E.got="",E.ultimate="",E.equip=null,E.equipName="",E.equipDisp="",t)for(var c in t.chefs)if(e.chefs[l].chefId==t.chefs[c].id){if(t.chefs[c].hasOwnProperty("got")&&(E.got=t.chefs[c].got),t.chefs[c].hasOwnProperty("ult")&&(E.ultimate=t.chefs[c].ult),t.chefs[c].hasOwnProperty("equip"))for(var M in p)if(t.chefs[c].equip==p[M].equipId){E.equip=p[M],E.equipName=p[M].name,E.equipDisp=p[M].name+"<br><small>"+p[M].skillDisp+"</small>";break}break}setDataForChef(E,E.equip,x,S.global,S.partial,null,S.self,T),C.push(E)}i.chefs=C;var R=[];for(var l in e.recipes)if(e.recipes[l].name){var _={};if(_=e.recipes[l],_.stirfry=e.recipes[l].stirfry||"",_.boil=e.recipes[l].boil||"",_.knife=e.recipes[l].knife||"",_.fry=e.recipes[l].fry||"",_.bake=e.recipes[l].bake||"",_.steam=e.recipes[l].steam||"",_.addition="",_.skillDisp=getSkillDisp(e.recipes[l]),_.timeDisp=secondsToTime(e.recipes[l].time),_.rarityDisp=getRarityDisp(e.recipes[l].rarity),e.recipes[l].hide?_.icon="<div class='icon-recipe2 recipe_"+e.recipes[l].recipeId+"'></div>":_.icon="<div class='icon-recipe recipe_"+e.recipes[l].recipeId+"'></div>",_.tags=e.recipes[l].tags||{},_.tagsDisp="",_.exTime=0,_.exTimeDisp="",a)for(var c in a.recipesTags)if(a.recipesTags[c].recipeId==e.recipes[l].recipeId){_.tags=a.recipesTags[c].tags,_.tagsDisp=getTagsDisp(a.recipesTags[c].tags,a.tags),_.exTime=a.recipesTags[c].experienceTime,_.exTimeDisp=getExTimeDisp(a.recipesTags[c].experienceTime,e.recipes[l].time);break}if(_.rank="",_.ex="",_.got="",t)for(var c in t.recipes)if(e.recipes[l].recipeId==t.recipes[c].id){t.recipes[c].hasOwnProperty("rank")&&(_.rank=t.recipes[c].rank),t.recipes[c].hasOwnProperty("ex")&&(_.ex=t.recipes[c].ex),t.recipes[c].hasOwnProperty("got")&&(_.got=t.recipes[c].got);break}_.oPrice=e.recipes[l].price;var A=ifUseEx(_);setDataForRecipe(_,S.global,A,T),_.efficiency=Math.floor(3600*e.recipes[l].price/e.recipes[l].time);var G=getMaterialsInfo(e.recipes[l],e.materials);_.materialsVal=G.materialsVal,_.materialsDisp=G.materialsDisp,_.veg=G.veg,_.meat=G.meat,_.creation=G.creation,_.fish=G.fish;var O=0;e.recipes[l].time>0&&(O=3600*G.materialsCount/e.recipes[l].time),_.allMaterialsEff=O?Math.floor(O):"";var V="";for(var F in e.combos)for(var P in e.combos[F].recipes)if(e.combos[F].recipes[P]==e.recipes[l].recipeId){for(var L in e.recipes)if(e.recipes[L].recipeId==e.combos[F].recipeId){V=e.recipes[L].name;break}break}_.comboVal=V,_.comboDisp=V||"-";var B=getRankGuestInfo(e.recipes[l],_.rank);_.rankGuestsVal=B.rankGuestsVal,_.rankGuestsDisp=B.rankGuestsDisp;var U=getRankGiftInfo(e.recipes[l],_.rank);_.rankGiftVal=U.rankGiftVal,_.rankGiftDisp=U.rankGiftDisp;var J="",Q="";for(var F in e.guests)for(var P in e.guests[F].gifts)if(e.recipes[l].name==e.guests[F].gifts[P].recipe){J+=" "+e.guests[F].name+" "+e.guests[F].gifts[P].antique+" ",Q+=e.guests[F].name+"-"+e.guests[F].gifts[P].antique+"<br>";break}_.guestsVal=J,_.guestsDisp=Q||"-",R.push(_)}return i.recipes=R,i.selectedQuests=[],i.questMaterials=[],i.allSelectedMaterials=[],i.recipeColNum=$("#recipe-table-header th").length,i.recipeAddColNum=0,i.recipeAddColNumMax=15,i.chefColNum=$("#chef-table-header th").length,i.chefAddColNum=0,i.chefAddColNumMax=15,i}function updateRecipeChefTable(e){$(".loading").removeClass("hidden"),setTimeout(function(){e=getUpdateData(e),updateRecipeTableData(e),updateChefTableData(e),$("#recipe-table").DataTable().draw(!1),$("#chef-table").DataTable().draw(!1),$(".loading").addClass("hidden")},0),$("#btn-chef-recal").closest(".inline-wrapper").addClass("hidden"),$("#btn-recipe-recal").closest(".inline-wrapper").addClass("hidden")}function getUpdateData(e){var a;try{var t=localStorage.getItem("data");a=JSON.parse(t)}catch(e){}var i=$("#chk-setting-show-final").prop("checked"),l=$("#chk-chef-apply-equips").prop("checked"),s=$("#chk-chef-apply-ultimate").prop("checked"),r=$("#chk-chef-apply-ultimate-person").prop("checked"),c=getUltimateData(e.chefs,a,e.skills,s,r);e.ultimateData=c;var n=$("#chk-chef-partial-ultimate").val(),o=getPartialUltimateData(e.chefs,e.partialSkill,s,n);for(var p in e.chefs)setDataForChef(e.chefs[p],e.chefs[p].equip,l,c.global,c.partial,o,c.self,i);for(var p in e.recipes){var d=ifUseEx(e.recipes[p]);setDataForRecipe(e.recipes[p],c.global,d,i)}return updateRecipesChefsData(e),updateChefsRecipesData(e),$("#recipe-table").is(":visible")||$('.main-nav a[data-id="1"]').attr("data-init","false"),$("#chef-table").is(":visible")||$('.main-nav a[data-id="2"]').attr("data-init","false"),e}function getQuestsData(e,a){var t=[];for(var i in e)e[i].type==a&&t.push(e[i]);return t}function getMaterialsData(e,a){if(!a){var t=$("#select-material-origin").val();for(var i in e.maps)if(t==e.maps[i].name){a=e.maps[i];break}}var l=a.materials,s=[],r=$("#chk-material-season").prop("checked"),c=Number($("#input-material-addition").val()),n=$("#input-material-skill").val();for(var i in l){var o={};for(var p in o.name=l[i].name,o.skill=l[i].skill,o.time=[],l[i].quantity){var d=0,u=0;(""==n||Number(n)>=l[i].skill)&&(d=l[i].quantity[p][0],u=l[i].quantity[p][1],r&&(d+=l[i].season[p],u+=l[i].season[p]),c&&(d=Math.ceil(+(d*(1+c/100)).toFixed(2)),u=Math.ceil(+(u*(1+c/100)).toFixed(2)))),o.time.push([d,u])}s.push(o)}var f={name:"总计",time:[]};for(var i in a.time){d=0,u=0;for(var p in s)d+=s[p].time[i][0],u+=s[p].time[i][1];f.time.push([d,u])}return s.push(f),s}function getMaterialsInfo(e,a){var t={},i="",l="",s=0,r=!1,c=!1,n=!1,o=!1;for(var p in e.materials)for(var d in a)if(e.materials[p].material==a[d].materialId){i+=a[d].name+"*"+e.materials[p].quantity+" ",l+=a[d].name+" ",s+=e.materials[p].quantity,e.materials[p].origin=a[d].origin,"菜棚"==a[d].origin||"菜地"==a[d].origin||"森林"==a[d].origin?r=!0:"鸡舍"==a[d].origin||"猪圈"==a[d].origin||"牧场"==a[d].origin?c=!0:"作坊"==a[d].origin?n=!0:"池塘"==a[d].origin&&(o=!0);break}return t.materialsDisp=i,t.materialsVal=l,t.materialsCount=s,t.veg=r,t.meat=c,t.creation=n,t.fish=o,t}function getRarityDisp(e){for(var a="",t=0;t<e;t++)a+="&#x2605;";return a}function getGender(e){return e.indexOf(1)>=0?"男":e.indexOf(2)>=0?"女":""}function getTagsDisp(e,a){var t="";for(var i in e)for(var l in a)if(e[i]==a[l].Id){t+=a[l].name+" ";break}return t}function getExTimeDisp(e,a){var t=e/1.5,i=e/2,l=e/2.5,s="可-"+Math.ceil(e/a)+"-"+secondsToTime(e)+"<br>优-"+Math.ceil(t/a)+"-"+secondsToTime(t)+"<br>特-"+Math.ceil(i/a)+"-"+secondsToTime(i)+"<br>神-"+Math.ceil(l/a)+"-"+secondsToTime(l);return s}function getOriginVal(e){var a=0;return"菜棚"==e?a=1:"菜地"==e?a=2:"森林"==e?a=3:"鸡舍"==e?a=4:"猪圈"==e?a=5:"牧场"==e?a=6:"作坊"==e?a=7:"池塘"==e?a=8:console.log("cannot find origin: "+a),a}function getRankGuestInfo(e,a){var t="",i="",l=$("#chk-recipe-filter-guest").prop("checked"),s=$("#chk-setting-done-mark").prop("checked");for(var r in e.guests){var c=!1;("优"==a&&0==r||"特"==a&&2!=r||"神"==a)&&(c=!0);var n="";0==r?n="优":1==r?n="特":2==r&&(n="神"),t+=(c&&s?"<span class='rank-done'>":"")+n+"-"+(e.guests[r].guest?e.guests[r].guest:"未知")+(c&&s?"</span>":"")+"<br>",(!l||l&&!c)&&(i+=" "+e.guests[r].guest+" ")}var o={};return o.rankGuestsDisp=t,o.rankGuestsVal=i,o}function getRankGiftInfo(e,a){var t=e.gift,i="",l=$("#chk-recipe-filter-antique").prop("checked"),s=$("#chk-setting-done-mark").prop("checked");"神"==a&&s&&(t="<span class='rank-done'>"+t+"</span>"),(!l||l&&"神"!=a)&&(i=e.gift);var r={};return r.rankGiftDisp=t,r.rankGiftVal=i,r}function ifUseEx(e){var a=$("#chk-recipe-apply-ex").prop("checked"),t=$("#chk-recipe-apply-ex-person").prop("checked");return!(!a||(!t||"是"!=e.ex)&&t)}function getUltimateData(e,a,t,i,l){var s=[],r=[],c=[];for(var n in e)if(i&&e[n].ultimateSkill){var o=!1;if(l){if(a)for(var p in a.chefs)if(e[n].chefId==a.chefs[p].id&&"是"==a.chefs[p].ult){o=!0;break}}else e[n].hide||(o=!0);if(o)for(var d in t)if(e[n].ultimateSkill==t[d].skillId){var u=[],f=[];for(var h in t[d].effect)if("Partial"==t[d].effect[h].condition)u.push(t[d].effect[h]);else if("Global"==t[d].effect[h].condition){var m=!1;for(var b in s)if(!(s[b].type!=t[d].effect[h].type||s[b].cal!=t[d].effect[h].cal&&(s[b].cal||t[d].effect[h].cal)||s[b].tag!=t[d].effect[h].tag&&(s[b].tag||t[d].effect[h].tag)||s[b].rarity!=t[d].effect[h].rarity&&(s[b].rarity||t[d].effect[h].rarity))){s[b].value=+(s[b].value+t[d].effect[h].value).toFixed(2),m=!0;break}m||s.push(JSON.parse(JSON.stringify(t[d].effect[h])))}else"Self"==t[d].effect[h].condition&&f.push(t[d].effect[h]);if(u.length){var v={};v.chefId=e[n].chefId,v.effect=u,r.push(v)}if(f.length){var g={};g.chefId=e[n].chefId,g.effect=f,c.push(g)}break}}var k={};return k.global=s,k.partial=r,k.self=c,k}function setPartialUltimateOptions(e,a){var t=[];for(var i in e)if(e[i].ultimateSkill)for(var l in a)if(e[i].ultimateSkill==a[l].skillId)for(var s in a[l].effect)if("Partial"==a[l].effect[s].condition){var r=getSkillInfo(a,a[l].skillId),c={};c.skill=r,c.chef=e[i],t.push(c);break}for(var i in t.sort(function(e,a){return e.skill.skillDisp.localeCompare(a.skill.skillDisp)}),t){var n="<option value='"+t[i].chef.chefId+"' data-subtext='"+t[i].skill.skillDisp.replace(/<br>/g," ")+"'>"+t[i].chef.name+"</option>",o=!1;for(var p in t[i].skill.skillEffect)if("Partial"==t[i].skill.skillEffect[p].condition&&"OpenTime"!=t[i].skill.skillEffect[p].type){o=!0;break}o&&$("#chk-chef-partial-ultimate").append(n),$("#chk-cal-partial-ultimate").append(n)}}function setSelfUltimateOptions(e,a){for(var t in e)if(e[t].ultimateSkill)for(var i in a)if(e[t].ultimateSkill==a[i].skillId)for(var l in a[i].effect)if("Self"==a[i].effect[l].condition&&"Material_Gain"!=a[i].effect[l].type&&"GuestDropCount"!=a[i].effect[l].type){var s=getSkillInfo(a,a[i].skillId),r="<option value='"+e[t].chefId+"' data-subtext='"+s.skillDisp.replace(/<br>/g," ")+"'>"+e[t].name+"</option>";$("#chk-cal-self-ultimate").append(r);break}}function setExOptions(e){for(var a in e){var t="<option value='"+e[a].recipeId+"' data-subtext='+"+e[a].exPrice+"'>"+e[a].name+"</option>";$("#chk-cal-ex").append(t)}}function setDataForRecipe(e,a,t,i){for(var l in e.limitVal=e.limit,e.ultimateAddition=0,a)"MaxEquipLimit"==a[l].type&&a[l].rarity==e.rarity&&(e.limitVal+=a[l].value),"UseAll"==a[l].type&&a[l].rarity==e.rarity&&(e.ultimateAddition=+(e.ultimateAddition+a[l].value).toFixed(2));e.limitDisp=getAtrributeDisp(e.limitVal,e.limit,i),e.ultimateAdditionDisp=getPercentDisp(e.ultimateAddition),e.price=e.oPrice,t&&(e.price+=e.exPrice),e.priceDisp=getAtrributeDisp(e.price,e.oPrice,i),e.totalPrice=e.price*e.limitVal,e.totalTime=e.time*e.limitVal,e.totalTimeDisp=secondsToTime(e.totalTime)}function getRankOptions(){var e=[],a={display:"",value:""};return e.push(a),a={},a.display="优",a.value="优",e.push(a),a={},a.display="特",a.value="特",e.push(a),a={},a.display="神",a.value="神",e.push(a),e}function getGotOptions(){var e=[],a={display:"否",value:""};return e.push(a),a={},a.display="是",a.value="是",e.push(a),e}function getEquipsOptions(e,a){var t=[],i={display:"无厨具",subtext:"",tokens:"",value:"",class:"hidden"};for(var l in t.push(i),e){var s=getSkillInfo(a,e[l].skill),r=s.skillDisp.replace(/<br>/g," ");i={};i.display=e[l].name,i.subtext=r,i.tokens=e[l].name+r,i.value=e[l].name,t.push(i)}return t}function getChefsOptions(e){var a=[],t={display:"无厨师",value:"",class:"hidden"};a.push(t),e.sort(function(e,a){return a.rarity-e.rarity});var i=$("#chk-cal-got").prop("checked"),l=$("#chk-cal-no-origin").prop("checked");for(var s in e)if((!i||e[s].got)&&(l||e[s].origin)){t={};t.display=e[s].name,t.value=e[s].name,a.push(t)}return a}function getSkillInfo(e,a){var t={},i="",l=[],s=[];for(var r in a.constructor===Array?s=a:a&&s.push(a),s){var c=!1;for(var n in e)if(e[n].skillId==s[r]){i+=e[n].desc+"<br>",l=l.concat(e[n].effect),c=!0;break}c||console.log(s[r])}return t.skillDisp=i,t.skillEffect=l,t}function getSkillDisp(e){var a="";return e.stirfry&&(a+="炒"+e.stirfry),e.boil&&(a+="煮"+e.boil),e.knife&&(a+="切"+e.knife),e.fry&&(a+="炸"+e.fry),e.bake&&(a+="烤"+e.bake),e.steam&&(a+="蒸"+e.steam),a}function getMaxLimit(e,a){var t=0;for(var i in 1==a?t=40:2==a?t=30:3==a?t=25:4==a?t=20:5==a&&(t=15),e.ultimateData.global)if(e.ultimateData.global[i].rarity==a&&"MaxEquipLimit"==e.ultimateData.global[i].type){t+=e.ultimateData.global[i].value;break}return t}function monitorStyle(){$("select.monitor-all").on("changed.bs.select",function(){$(this).val().length==$(this).find("option").length?$(this).selectpicker("setStyle","btn-info","remove"):$(this).selectpicker("setStyle","btn-info","add")}),$("select.monitor-none").on("changed.bs.select",function(){changeSelectStyle(this)}),$("input[type=text].monitor-none").keyup(function(){changeInputStyle(this)}),$("input[type=checkbox].monitor-none").click(function(){changeCheckStyle(this)})}function changeSelectStyle(e){0==$(e).val().length?$(e).selectpicker("setStyle","btn-info","remove"):$(e).selectpicker("setStyle","btn-info","add")}function changeInputStyle(e){$.trim($(e).val()).length>0?$(e).addClass("btn-info"):$(e).removeClass("btn-info")}function changeCheckStyle(e){$(e).prop("checked")?$(e).closest(".btn").addClass("btn-info"):$(e).closest(".btn").removeClass("btn-info")}function checkMonitorStyle(){$("input[type=text].monitor-none").each(function(){changeInputStyle(this)}),$("input[type=search].monitor-none").each(function(){changeInputStyle(this)}),$("input[type=checkbox].monitor-none").each(function(){changeCheckStyle(this)})}function arraysEqual(e,a){if(e.length!=a.length)return!1;for(var t=0;t<e.length;t++)if(a.indexOf(e[t])<0)return!1;return!0}function changeTableHeaderClass(e,a,t){t?$(e.column(a).header()).removeClass("none never").addClass("all"):$("#chk-setting-expand").prop("checked")?$(e.column(a).header()).removeClass("all never").addClass("none"):$(e.column(a).header()).removeClass("all none").addClass("never")}function initRecipeShow(){var e=$("#recipe-table").DataTable();$("#chk-recipe-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-recipe-show option[value=4]").is(":selected"),t=5;t<=9;t++)changeTableHeaderClass(e,t,a);e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initChefShow(){var e=$("#chef-table").DataTable();$("#chk-chef-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-chef-show option[value=4]").is(":selected"),t=5;t<=9;t++)changeTableHeaderClass(e,t,a);var i=$("#chk-chef-show option[value=11]").is(":selected");for(t=12;t<=14;t++)changeTableHeaderClass(e,t,i);e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initEquipShow(){var e=$("#equip-table").DataTable();$("#chk-equip-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initDecorationShow(){var e=$("#decoration-table").DataTable();$("#chk-decoration-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initQuestShow(e){e.column(1).visible("支线任务"==$("#select-quest-type").val(),!1),e.columns.adjust().draw(!1)}function initCalChefsShow(e){$("#chk-cal-chefs-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)});for(var a=$("#chk-cal-chefs-show option[value=4]").is(":selected"),t=5;t<=9;t++)changeTableHeaderClass(e,t,a);e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalEquipsShow(e){$("#chk-cal-equips-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalMaterialsShow(e){$("#chk-cal-materials-show option").each(function(){changeTableHeaderClass(e,Number($(this).val()),this.selected)}),e.responsive.rebuild(),e.responsive.recalc(),e.columns.adjust().draw(!1)}function initCalResultsShow(e,a,t){a.column(1).visible(!1,!1),"recipes"==e?(t.find(".chk-cal-results-show-recipe-rank").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-recipe-rank-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-skill-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-chef-equip-addition").prop("checked",!1).closest(".btn").addClass("hidden"),t.find(".chk-cal-results-show-recipe-real-total-price").prop("checked",!1).closest(".btn").addClass("hidden"),private?t.find(".chk-cal-results-lock-order").closest(".header-wrapper").removeClass("hidden"):a.column(0).visible(!1,!1),a.column(2).visible(!1,!1),a.column(3).visible(!1,!1),a.column(15).visible(!1,!1),currentRule&&currentRule.hasOwnProperty("MaterialsNum")?(a.column(16).visible(!0,!1),a.column(17).visible(!0,!1)):(a.column(16).visible(!1,!1),a.column(17).visible(!1,!1))):"optimal"==e?(a.column(0).visible(!1,!1),a.column(16).visible(!1,!1),a.column(17).visible(!1,!1),a.column(18).visible(!1,!1)):"self-select"==e&&(t.find(".chk-cal-results-show-recipe-id").prop("checked",!1).closest(".btn").addClass("hidden"),a.column(0).visible(!1,!1),a.column(17).visible(!1,!1)),a.column(4).visible(t.find(".chk-cal-results-show-recipe-id").prop("checked"),!1),a.column(6).visible(t.find(".chk-cal-results-show-recipe-rarity").prop("checked"),!1);var i=t.find(".chk-cal-results-show-recipe-skill").prop("checked");a.column(7).visible(i,!1),a.column(8).visible(i,!1),a.column(9).visible(i,!1),a.column(10).visible(i,!1),a.column(11).visible(i,!1),a.column(12).visible(i,!1),a.column(13).visible(t.find(".chk-cal-results-show-recipe-material").prop("checked"),!1),a.column(14).visible(t.find(".chk-cal-results-show-recipe-origin").prop("checked"),!1),a.column(19).visible(t.find(".chk-cal-results-show-recipe-price").prop("checked"),!1),a.column(20).visible(t.find(".chk-cal-results-show-recipe-rank").prop("checked"),!1),a.column(21).visible(t.find(".chk-cal-results-show-recipe-rank-addition").prop("checked"),!1),a.column(22).visible(t.find(".chk-cal-results-show-chef-skill-addition").prop("checked"),!1),a.column(23).visible(t.find(".chk-cal-results-show-chef-equip-addition").prop("checked"),!1),a.column(24).visible(t.find(".chk-cal-results-show-bonus-addition").prop("checked"),!1),a.column(25).visible(t.find(".chk-cal-results-show-ultimate-addition").prop("checked"),!1),a.column(26).visible(t.find(".chk-cal-results-show-decoration-addition").prop("checked"),!1),a.column(27).visible(t.find(".chk-cal-results-show-recipe-total-price").prop("checked"),!1),a.column(28).visible(t.find(".chk-cal-results-show-recipe-real-total-price").prop("checked"),!1),a.column(29).visible(t.find(".chk-cal-results-show-bonus-score").prop("checked"),!1),a.column(31).visible(t.find(".chk-cal-results-show-total-time").prop("checked"),!1),a.column(32).visible(t.find(".chk-cal-results-show-efficiency").prop("checked"),!1),a.columns.adjust().draw(!1)}function initInfo(e){$("#pagination-history").pagination({dataSource:e.history,callback:function(e,a){var t=historyTemplate(e);$("#data-history").html(t)},pageSize:5,showPageNumbers:!1,showNavigator:!0,showPrevious:!0,showNext:!0})}function historyTemplate(e){var a='<table class="table table-condensed history-table">';return $.each(e,function(e,t){a+='<tr><td class="history-dt">'+t.date+"</td><td>"+t.content+"<td></tr>"}),a+="</table>",a}function initVersionTip(e){$(".alert-version").each(function(){if("true"==$(this).attr("data-show")){var a=$(this).attr("data-id"),t=Number($(this).attr("data-version")),i=!0;e&&e[a]&&Number(e[a])==t&&(i=!1),i&&$(this).removeClass("hidden"),$(this).on("closed.bs.alert",function(){updateLocalData(a,t),updateScrollHeight()})}})}function getInputHtml(e,a,t,i){var l,s,r;switch(r={type:"input",html:null,settings:null},t.inputTypes&&$.each(t.inputTypes,function(e,t){t.column==a&&(l=t,s=l.type.toLowerCase())}),r.settings=l,s){case"list":var c,n="data-live-search='false'";l.search&&(n="data-live-search='true'"),r.html="<select "+n+" data-width='fit' data-dropdown-align-right='auto' data-live-search-placeholder='查找' data-none-results-text='没有找到' data-none-selected-text=''>",c=l.optionsp?l.options[e]:l.options,$.each(c,function(e,a){r.html=r.html+"<option value='"+a.value+"'",a.tokens&&(r.html+=" data-tokens='"+a.tokens+"'"),a.subtext&&(r.html+=" data-subtext='"+a.subtext+"'"),a.class&&(r.html+=" class='"+a.class+"'"),i==a.value&&(r.html+=" selected"),r.html+=">"+a.display+"</option>"}),r.html=r.html+"</select>",r.type=s;break;default:r.html="<input class='form-control' value='"+i+"'></input>"}return r}function sanitizeCellValue(e){return null==e||e.length<1?"":(isNaN(e)&&(e=e.replace(/'/g,"&#39;")),e)}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),i=t.exec(a);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function UpdateQueryString(e,a,t){t||(t=window.location.href);var i,l=new RegExp("([?&])"+e+"=.*?(&|#|$)(.*)","gi");if(l.test(t))return null!=a?t.replace(l,"$1"+e+"="+a+"$2$3"):(i=t.split("#"),t=i[0].replace(l,"$1$3").replace(/(&|\?)$/,""),void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t);if(null!=a){var s=-1!==t.indexOf("?")?"&":"?";return i=t.split("#"),t=i[0]+s+e+"="+a,void 0!==i[1]&&null!==i[1]&&(t+="#"+i[1]),t}return t}$(function(){window.location.href.indexOf("github")>0&&$(".loading-text").append("<h3>您访问的是github网站，如您是国内用户，建议使用gitee网站<a href='https://foodgame.gitee.io'>https://foodgame.gitee.io</a></h3>")});var currentRule,private=!1;$.fn.dataTable.Api.register("MakeCellsEditable()",function(e){var a=this.table();$.fn.extend({updateEditableCell:function(e,a){var t=$(e).closest("table").DataTable().table(),i=t.row($(e).parents("tr")),l=t.cell($(e).closest("td")),s=$(e),r=l.data(),c=s.val();l.data(c),a.onUpdate&&a.onUpdate(t,i,l,r)}}),"destroy"===e&&($(a.body()).removeClass("processing"),$(a.body()).off("click","td"),a=null),null!=a&&$(a.body()).on("click","td",function(){if(!$(a.body()).hasClass("processing")&&!$(this).hasClass("child")&&!$(this).hasClass("dataTables_empty")){var t=a.cell(this).index().row,i=a.cell(this).index().column;if(e.columns&&e.columns.indexOf(i)>-1||!e.columns){var l=a.cell(this).node(),s=a.cell(this).data();if(s=sanitizeCellValue(s),!$(l).find("input").length&&!$(l).find("select").length){e.waitUpdate&&$(a.body()).addClass("processing");var r=getInputHtml(t,i,e,s);$(l).html(r.html),"input"==r.type?$(l).find("input").select().focus().on("focusout",function(){$(this).updateEditableCell(this,e)}):"list"==r.type&&($(l).find("select").selectpicker("hide").on("hidden.bs.select",function(a){$(this).updateEditableCell(this,e)}),setTimeout(function(){$(l).find("select").selectpicker("toggle").selectpicker("show")},0),r.settings.clear&&($("<div class='bs-actionsbox'><div class='btn-group btn-group-sm btn-block'><button type='button' class='btn btn-default btn-bs-clear'>清空</button></div></div>").insertAfter($(l).find(".bs-searchbox")),$(l).find(".btn-bs-clear").click(function(){$(l).find("select").selectpicker("val",""),$(l).find("select").selectpicker("hide"),$(this).updateEditableCell(this,e)})))}}}})});